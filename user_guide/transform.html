

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Transformations &mdash; Altair 2.4.1 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/altair-plot.css" type="text/css" />
  <link rel="stylesheet" href="../_static/altair-gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bindings, Selections, Conditions: Making Charts Interactive" href="interactions.html" />
    <link rel="prev" title="Marks" href="marks.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Altair
          

          
            
            <img src="../_static/altair-logo-light.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2.4.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/starting.html">Basic Statistical Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Example Gallery</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">Specifying Data in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="encoding.html">Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="marks.html">Marks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Transformations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aggregate-transforms">Aggregate Transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#bin-transforms">Bin transforms</a></li>
<li class="toctree-l2"><a class="reference internal" href="#calculate-transform">Calculate Transform</a></li>
<li class="toctree-l2"><a class="reference internal" href="#filter-transform">Filter Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#filter-expression">Filter Expression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-predicates">Field Predicates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selection-predicates">Selection Predicates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logical-operands">Logical Operands</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lookup-transform">Lookup Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#combining-datasets-with-pandas-merge">Combining Datasets with pandas.merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combining-datasets-with-a-lookup-transform">Combining Datasets with a Lookup Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-lookup-transforms-for-geographical-visualization">Example: Lookup Transforms for Geographical Visualization</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#timeunit-transform">TimeUnit Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#timeunit-within-encoding">TimeUnit Within Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timeunit-as-a-transform">TimeUnit as a Transform</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#window-transform">Window Transform</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interactions.html">Bindings, Selections, Conditions: Making Charts Interactive</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Top-Level Chart Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="compound_charts.html">Compound Charts: Layer, HConcat, VConcat, Repeat, Facet</a></li>
<li class="toctree-l1"><a class="reference internal" href="saving_charts.html">Saving Altair Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="customization.html">Customizing Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="times_and_dates.html">Times and Dates in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Display Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderers.html">Altair Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Altair Internals: Understanding the Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem.html">Altair Ecosystem</a></li>
</ul>
<p class="caption"><span class="caption-text">Case Studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../case_studies/exploring-weather.html">Exploring Seattle Weather</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="importing.html">Importing Vega &amp; Vega-Lite Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="display_frontends.html">Displaying Charts in Various Frontends</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_renderers.html">Customizing Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_transformers.html">Data transformers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Altair</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Data Transformations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user_guide/transform.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-transformations">
<span id="user-guide-transformations"></span><h1>Data Transformations<a class="headerlink" href="#data-transformations" title="Permalink to this headline">¶</a></h1>
<p>It is often necessary to transform or filter data in the process of visualizing
it. In Altair you can do this one of two ways:</p>
<ol class="arabic simple">
<li>Before the chart definition, using standard Pandas data transformations.</li>
<li>Within the chart definition, using Vega-Lite’s data transformation tools.</li>
</ol>
<p>In most cases, we suggest that you use the first approach, because it is more
straightforward to those who are familiar with data manipulation in Python, and
because the Pandas package offers much more flexibility than Vega-Lite in
available data manipulations.</p>
<p>The second approach becomes useful when the data source is not a dataframe, but,
for example, a URL pointer to a JSON or CSV file. It can also be useful in a
compound chart where different views of the dataset require different
transformations.</p>
<p>This second approach – specifying data transformations within the chart
specification itself – can be accomplished using the <code class="docutils literal"><span class="pre">transform_*</span></code>
methods of top-level objects:</p>
<table border="1" class="docutils">
<colgroup>
<col width="34%" />
<col width="66%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_aggregate" title="altair.Chart.transform_aggregate"><code class="xref py py-meth docutils literal"><span class="pre">transform_aggregate()</span></code></a></td>
<td>Create a new data column by aggregating an existing column.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_bin" title="altair.Chart.transform_bin"><code class="xref py py-meth docutils literal"><span class="pre">transform_bin()</span></code></a></td>
<td>Create a new data column by binning an existing column.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_calculate" title="altair.Chart.transform_calculate"><code class="xref py py-meth docutils literal"><span class="pre">transform_calculate()</span></code></a></td>
<td>Create a new data column using an arithmetic calculation on an existing column.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_filter" title="altair.Chart.transform_filter"><code class="xref py py-meth docutils literal"><span class="pre">transform_filter()</span></code></a></td>
<td>Select a subset of data based on a condition.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_lookup" title="altair.Chart.transform_lookup"><code class="xref py py-meth docutils literal"><span class="pre">transform_lookup()</span></code></a></td>
<td>One-sided join of two datasets based on a lookup key.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_timeunit" title="altair.Chart.transform_timeunit"><code class="xref py py-meth docutils literal"><span class="pre">transform_timeunit()</span></code></a></td>
<td>Discretize/group a date by a time unit (day, month, year, etc.)</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_window" title="altair.Chart.transform_window"><code class="xref py py-meth docutils literal"><span class="pre">transform_window()</span></code></a></td>
<td>Compute a windowed aggregation</td>
</tr>
</tbody>
</table>
<p>We will see some examples of these transforms in the following sections.</p>
<div class="section" id="aggregate-transforms">
<span id="user-guide-aggregate-transform"></span><h2>Aggregate Transforms<a class="headerlink" href="#aggregate-transforms" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to aggregate data within Altair: within the encoding itself,
or using a top level aggregate transform.</p>
<p>The aggregate property of a field definition can be used to compute aggregate
summary statistics (e.g., median, min, max) over groups of data.</p>
<p>If at least one fields in the specified encoding channels contain aggregate,
the resulting visualization will show aggregate data. In this case, all
fields without aggregation function specified are treated as group-by fields
in the aggregation process.</p>
<p>For example, the following bar chart aggregates mean of <code class="docutils literal"><span class="pre">acceleration</span></code>,
grouped by the number of Cylinders.</p>
<div class="highlight-python" id="transform-rst-altair-source-0"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">cars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cars</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Cylinders:O&#39;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean(Acceleration):Q&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-0">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "aggregate": "mean", "field": "Acceleration"}, "y": {"type": "ordinal", "field": "Cylinders"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-0', spec, opt).catch(console.err);
  });
</script>
</div><p>The Altair shorthand string:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(acceleration):Q&#39;</span><span class="p">,</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>is made available for convenience, and is equivalent to the longer form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;acceleration&#39;</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">),</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>For more information on shorthand encodings specifications, see
<a class="reference internal" href="encoding.html#encoding-aggregates"><span class="std std-ref">Binning and Aggregation</span></a>.</p>
<p>The same plot can be shown using an explicitly computed aggregation, using the
<a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_aggregate" title="altair.Chart.transform_aggregate"><code class="xref py py-meth docutils literal"><span class="pre">transform_aggregate()</span></code></a> method:</p>
<div class="highlight-python" id="transform-rst-altair-source-1"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Cylinders:O&#39;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean_acc:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>
    <span class="n">mean_acc</span><span class="o">=</span><span class="s1">&#39;mean(Acceleration)&#39;</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cylinders&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-1">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "field": "mean_acc"}, "y": {"type": "ordinal", "field": "Cylinders"}}, "transform": [{"aggregate": [{"op": "mean", "field": "Acceleration", "as": "mean_acc"}], "groupby": ["Cylinders"]}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-1', spec, opt).catch(console.err);
  });
</script>
</div><p>For a list of available aggregates, see <a class="reference internal" href="encoding.html#encoding-aggregates"><span class="std std-ref">Binning and Aggregation</span></a>.</p>
</div>
<div class="section" id="bin-transforms">
<span id="user-guide-bin-transform"></span><h2>Bin transforms<a class="headerlink" href="#bin-transforms" title="Permalink to this headline">¶</a></h2>
<p>As with <a class="reference internal" href="#user-guide-aggregate-transform"><span class="std std-ref">Aggregate Transforms</span></a>, there are two ways to apply
a bin transform in Altair: within the encoding itself, or using a top-level
bin transform.</p>
<p>An common application of a bin transform is when creating a histogram:</p>
<div class="highlight-python" id="transform-rst-altair-source-2"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">movies</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;IMDB_Rating:Q&quot;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count()&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-2">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/movies.json"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "bin": true, "field": "IMDB_Rating"}, "y": {"type": "quantitative", "aggregate": "count"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-2', spec, opt).catch(console.err);
  });
</script>
</div><p>But a bin transform can be useful in other applications; for example, here we
bin a continuous field to create a discrete color map:</p>
<div class="highlight-python" id="transform-rst-altair-source-3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">cars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cars</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Horsepower:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Miles_per_Gallon:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;Acceleration:Q&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">maxbins</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-3">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "point", "encoding": {"color": {"type": "quantitative", "bin": {"maxbins": 5}, "field": "Acceleration"}, "x": {"type": "quantitative", "field": "Horsepower"}, "y": {"type": "quantitative", "field": "Miles_per_Gallon"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-3', spec, opt).catch(console.err);
  });
</script>
</div><p>In the first case we set <code class="docutils literal"><span class="pre">bin</span> <span class="pre">=</span> <span class="pre">True</span></code>, which uses the default bin settings.
In the second case, we exercise more fine-tuned control over the bin parameters
by passing a <code class="xref py py-class docutils literal"><span class="pre">Bin</span></code> object.</p>
<p>If you are using the same binnings in multiple chart components, it can be useful
to instead define the binning at the top level, using <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_bin" title="altair.Chart.transform_bin"><code class="xref py py-meth docutils literal"><span class="pre">transform_bin()</span></code></a>
method.</p>
<p>Here is the above histogram created using a top-level bin transform:</p>
<div class="highlight-python" id="transform-rst-altair-source-4"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">movies</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;binned_rating:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count()&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_bin</span><span class="p">(</span>
    <span class="s1">&#39;binned_rating&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;IMDB_Rating&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-4">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/movies.json"}, "mark": "bar", "encoding": {"x": {"type": "ordinal", "field": "binned_rating"}, "y": {"type": "quantitative", "aggregate": "count"}}, "transform": [{"bin": true, "field": "IMDB_Rating", "as": "binned_rating"}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-4', spec, opt).catch(console.err);
  });
</script>
</div><p>And here is the transformed color scale using a top-level bin transform:</p>
<div class="highlight-python" id="transform-rst-altair-source-5"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">cars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cars</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Horsepower:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Miles_per_Gallon:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;binned_acc:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_bin</span><span class="p">(</span>
    <span class="s1">&#39;binned_acc&#39;</span><span class="p">,</span> <span class="s1">&#39;Acceleration&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">maxbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-5">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "point", "encoding": {"color": {"type": "ordinal", "field": "binned_acc"}, "x": {"type": "quantitative", "field": "Horsepower"}, "y": {"type": "quantitative", "field": "Miles_per_Gallon"}}, "transform": [{"bin": {"maxbins": 5}, "field": "Acceleration", "as": "binned_acc"}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-5', spec, opt).catch(console.err);
  });
</script>
</div><p>The advantage of the top-level transform is that the same named field can be
used in multiple places in the chart if desired.
Note the slight difference in binning behavior between the encoding-based binnings
(which preserve the range of the bins) and the transform-based binnings (which
collapse each bin to a single representative value.</p>
</div>
<div class="section" id="calculate-transform">
<span id="user-guide-calculate-transform"></span><h2>Calculate Transform<a class="headerlink" href="#calculate-transform" title="Permalink to this headline">¶</a></h2>
<p>The calculate transform allows the user to define new fields in the dataset
which are calculated from other fields using an expression syntax.</p>
<p>As a simple example, here we take data with a simple input sequence, and compute
a some trigonometric quantities:</p>
<div class="highlight-python" id="transform-rst-altair-source-6"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">)})</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y:Q&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cos(datum.t * PI / 50)&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sin(datum.t * PI / 25)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-6">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"name": "data-154c237c455a7f8fb343ee63b47dd948"}, "mark": "line", "encoding": {"order": {"type": "quantitative", "field": "t"}, "x": {"type": "quantitative", "field": "x"}, "y": {"type": "quantitative", "field": "y"}}, "transform": [{"calculate": "cos(datum.t * PI / 50)", "as": "x"}, {"calculate": "sin(datum.t * PI / 25)", "as": "y"}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json", "datasets": {"data-154c237c455a7f8fb343ee63b47dd948": [{"t": 0}, {"t": 1}, {"t": 2}, {"t": 3}, {"t": 4}, {"t": 5}, {"t": 6}, {"t": 7}, {"t": 8}, {"t": 9}, {"t": 10}, {"t": 11}, {"t": 12}, {"t": 13}, {"t": 14}, {"t": 15}, {"t": 16}, {"t": 17}, {"t": 18}, {"t": 19}, {"t": 20}, {"t": 21}, {"t": 22}, {"t": 23}, {"t": 24}, {"t": 25}, {"t": 26}, {"t": 27}, {"t": 28}, {"t": 29}, {"t": 30}, {"t": 31}, {"t": 32}, {"t": 33}, {"t": 34}, {"t": 35}, {"t": 36}, {"t": 37}, {"t": 38}, {"t": 39}, {"t": 40}, {"t": 41}, {"t": 42}, {"t": 43}, {"t": 44}, {"t": 45}, {"t": 46}, {"t": 47}, {"t": 48}, {"t": 49}, {"t": 50}, {"t": 51}, {"t": 52}, {"t": 53}, {"t": 54}, {"t": 55}, {"t": 56}, {"t": 57}, {"t": 58}, {"t": 59}, {"t": 60}, {"t": 61}, {"t": 62}, {"t": 63}, {"t": 64}, {"t": 65}, {"t": 66}, {"t": 67}, {"t": 68}, {"t": 69}, {"t": 70}, {"t": 71}, {"t": 72}, {"t": 73}, {"t": 74}, {"t": 75}, {"t": 76}, {"t": 77}, {"t": 78}, {"t": 79}, {"t": 80}, {"t": 81}, {"t": 82}, {"t": 83}, {"t": 84}, {"t": 85}, {"t": 86}, {"t": 87}, {"t": 88}, {"t": 89}, {"t": 90}, {"t": 91}, {"t": 92}, {"t": 93}, {"t": 94}, {"t": 95}, {"t": 96}, {"t": 97}, {"t": 98}, {"t": 99}, {"t": 100}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-6', spec, opt).catch(console.err);
  });
</script>
</div><p>Each argument within <code class="docutils literal"><span class="pre">transform_calculate</span></code> is a <a class="reference external" href="https://vega.github.io/vega/docs/expressions/">Vega expression</a> string,
which is a well-defined set of javascript-style operations that can be used
to calculate a new field from an existing one.</p>
<p>To streamline building these vega expressions in Python, Altair provides the
<code class="xref py py-mod docutils literal"><span class="pre">altair.expr</span></code> module which provides constants and functions to allow
these expressions to be constructed with Python syntax; for example:</p>
<div class="highlight-python" id="transform-rst-altair-source-7"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">altair</span> <span class="kn">import</span> <span class="n">expr</span><span class="p">,</span> <span class="n">datum</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y:Q&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="n">expr</span><span class="o">.</span><span class="n">PI</span> <span class="o">/</span> <span class="mi">50</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="n">expr</span><span class="o">.</span><span class="n">PI</span> <span class="o">/</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-7">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"name": "data-154c237c455a7f8fb343ee63b47dd948"}, "mark": "line", "encoding": {"order": {"type": "quantitative", "field": "t"}, "x": {"type": "quantitative", "field": "x"}, "y": {"type": "quantitative", "field": "y"}}, "transform": [{"calculate": "cos(((datum.t * PI) / 50))", "as": "x"}, {"calculate": "sin(((datum.t * PI) / 25))", "as": "y"}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json", "datasets": {"data-154c237c455a7f8fb343ee63b47dd948": [{"t": 0}, {"t": 1}, {"t": 2}, {"t": 3}, {"t": 4}, {"t": 5}, {"t": 6}, {"t": 7}, {"t": 8}, {"t": 9}, {"t": 10}, {"t": 11}, {"t": 12}, {"t": 13}, {"t": 14}, {"t": 15}, {"t": 16}, {"t": 17}, {"t": 18}, {"t": 19}, {"t": 20}, {"t": 21}, {"t": 22}, {"t": 23}, {"t": 24}, {"t": 25}, {"t": 26}, {"t": 27}, {"t": 28}, {"t": 29}, {"t": 30}, {"t": 31}, {"t": 32}, {"t": 33}, {"t": 34}, {"t": 35}, {"t": 36}, {"t": 37}, {"t": 38}, {"t": 39}, {"t": 40}, {"t": 41}, {"t": 42}, {"t": 43}, {"t": 44}, {"t": 45}, {"t": 46}, {"t": 47}, {"t": 48}, {"t": 49}, {"t": 50}, {"t": 51}, {"t": 52}, {"t": 53}, {"t": 54}, {"t": 55}, {"t": 56}, {"t": 57}, {"t": 58}, {"t": 59}, {"t": 60}, {"t": 61}, {"t": 62}, {"t": 63}, {"t": 64}, {"t": 65}, {"t": 66}, {"t": 67}, {"t": 68}, {"t": 69}, {"t": 70}, {"t": 71}, {"t": 72}, {"t": 73}, {"t": 74}, {"t": 75}, {"t": 76}, {"t": 77}, {"t": 78}, {"t": 79}, {"t": 80}, {"t": 81}, {"t": 82}, {"t": 83}, {"t": 84}, {"t": 85}, {"t": 86}, {"t": 87}, {"t": 88}, {"t": 89}, {"t": 90}, {"t": 91}, {"t": 92}, {"t": 93}, {"t": 94}, {"t": 95}, {"t": 96}, {"t": 97}, {"t": 98}, {"t": 99}, {"t": 100}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-7', spec, opt).catch(console.err);
  });
</script>
</div><p>Altair expressions are designed to output valid Vega expressions. The benefit of
using them is that proper syntax is ensured by the Python interpreter, and tab
completion of the <code class="xref py py-mod docutils literal"><span class="pre">expr</span></code> submodule can be used to explore the
available functions and constants.</p>
<p>These expressions can also be used when constructing a
<a class="reference internal" href="#user-guide-filter-transform"><span class="std std-ref">Filter Transform</span></a>, as we shall see next.</p>
</div>
<div class="section" id="filter-transform">
<span id="user-guide-filter-transform"></span><h2>Filter Transform<a class="headerlink" href="#filter-transform" title="Permalink to this headline">¶</a></h2>
<p>The filter transform removes objects from a data stream based on a provided
filter expression, selection, or other filter predicate. A filter can be
added at the top level of a chart using the <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_filter" title="altair.Chart.transform_filter"><code class="xref py py-meth docutils literal"><span class="pre">Chart.transform_filter()</span></code></a>
method. The argument to <code class="docutils literal"><span class="pre">transform_filter</span></code> can be one of a number of
expressions and objects:</p>
<ol class="arabic simple">
<li>A <a class="reference external" href="https://vega.github.io/vega/docs/expressions/">Vega expression</a> expressed as a string or built using the <code class="xref py py-mod docutils literal"><span class="pre">expr</span></code> module</li>
<li>A Field predicate, such as <a class="reference internal" href="generated/core/altair.FieldOneOfPredicate.html#altair.FieldOneOfPredicate" title="altair.FieldOneOfPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldOneOfPredicate</span></code></a>,
<a class="reference internal" href="generated/core/altair.FieldRangePredicate.html#altair.FieldRangePredicate" title="altair.FieldRangePredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldRangePredicate</span></code></a>, <a class="reference internal" href="generated/core/altair.FieldEqualPredicate.html#altair.FieldEqualPredicate" title="altair.FieldEqualPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldEqualPredicate</span></code></a>,
<a class="reference internal" href="generated/core/altair.FieldLTPredicate.html#altair.FieldLTPredicate" title="altair.FieldLTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTPredicate</span></code></a>, <a class="reference internal" href="generated/core/altair.FieldGTPredicate.html#altair.FieldGTPredicate" title="altair.FieldGTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTPredicate</span></code></a>,
<a class="reference internal" href="generated/core/altair.FieldLTEPredicate.html#altair.FieldLTEPredicate" title="altair.FieldLTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTEPredicate</span></code></a>, <a class="reference internal" href="generated/core/altair.FieldGTEPredicate.html#altair.FieldGTEPredicate" title="altair.FieldGTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTEPredicate</span></code></a>,</li>
<li>A Selection predicate or object created by <a class="reference internal" href="generated/api/altair.selection.html#altair.selection" title="altair.selection"><code class="xref py py-func docutils literal"><span class="pre">selection()</span></code></a></li>
<li>A Logical operand that combines any of the above</li>
</ol>
<p>We’ll show a brief example of each of these in the following sections</p>
<div class="section" id="filter-expression">
<h3>Filter Expression<a class="headerlink" href="#filter-expression" title="Permalink to this headline">¶</a></h3>
<p>A filter expression uses the <a class="reference external" href="https://vega.github.io/vega/docs/expressions/">Vega expression</a> language, either specified
directly as a string, or built using the <code class="xref py py-mod docutils literal"><span class="pre">expr</span></code> module.
This can be useful when, for example, selecting only a subset of data.</p>
<p>For example:</p>
<div class="highlight-python" id="transform-rst-altair-source-8"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">altair</span> <span class="kn">import</span> <span class="n">datum</span>

<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;people:Q&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-8">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "area", "encoding": {"x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "field": "people"}}, "transform": [{"filter": "((datum.year === 2000) && (datum.sex === 1))"}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-8', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice that, like in the <a class="reference internal" href="#user-guide-filter-transform"><span class="std std-ref">Filter Transform</span></a>, data values are
referenced via the name <code class="docutils literal"><span class="pre">datum</span></code>.</p>
</div>
<div class="section" id="field-predicates">
<h3>Field Predicates<a class="headerlink" href="#field-predicates" title="Permalink to this headline">¶</a></h3>
<p>Field predicates overlap somewhat in function with expression predicates, but
have the advantage that their contents are validated by the schema. Examples
are:</p>
<ul class="simple">
<li><a class="reference internal" href="generated/core/altair.FieldEqualPredicate.html#altair.FieldEqualPredicate" title="altair.FieldEqualPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldEqualPredicate</span></code></a> evaluates whether a field is equal to
a particular value</li>
<li><a class="reference internal" href="generated/core/altair.FieldOneOfPredicate.html#altair.FieldOneOfPredicate" title="altair.FieldOneOfPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldOneOfPredicate</span></code></a> evaluates whether a field is among a list of
specified values.</li>
<li><a class="reference internal" href="generated/core/altair.FieldRangePredicate.html#altair.FieldRangePredicate" title="altair.FieldRangePredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldRangePredicate</span></code></a> evaluates whether a continuous field is within
a range of values.</li>
<li><a class="reference internal" href="generated/core/altair.FieldLTPredicate.html#altair.FieldLTPredicate" title="altair.FieldLTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTPredicate</span></code></a> evaluates whether a continuous field is less
than a given value</li>
<li><a class="reference internal" href="generated/core/altair.FieldGTPredicate.html#altair.FieldGTPredicate" title="altair.FieldGTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTPredicate</span></code></a> evaluates whether a continuous field is greater
than a given value</li>
<li><a class="reference internal" href="generated/core/altair.FieldLTEPredicate.html#altair.FieldLTEPredicate" title="altair.FieldLTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTEPredicate</span></code></a> evaluates whether a continuous field is less
than or equal to a given value</li>
<li><a class="reference internal" href="generated/core/altair.FieldGTEPredicate.html#altair.FieldGTEPredicate" title="altair.FieldGTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTEPredicate</span></code></a> evaluates whether a continuous field is greater
than or equal to a given value</li>
</ul>
<p>Here is an example of a <a class="reference internal" href="generated/core/altair.FieldEqualPredicate.html#altair.FieldEqualPredicate" title="altair.FieldEqualPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldEqualPredicate</span></code></a> used to select just the
values from year 2000 as in the above chart:</p>
<div class="highlight-python" id="transform-rst-altair-source-9"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">FieldEqualPredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">equal</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-9">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "transform": [{"filter": {"equal": 2000, "field": "year"}}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-9', spec, opt).catch(console.err);
  });
</script>
</div><p>A <a class="reference internal" href="generated/core/altair.FieldOneOfPredicate.html#altair.FieldOneOfPredicate" title="altair.FieldOneOfPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldOneOfPredicate</span></code></a> is similar, but allows selection of any number
of specific values:</p>
<div class="highlight-python" id="transform-rst-altair-source-10"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">FieldOneOfPredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">oneOf</span><span class="o">=</span><span class="p">[</span><span class="mi">1900</span><span class="p">,</span> <span class="mi">1950</span><span class="p">,</span> <span class="mi">2000</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-10">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "transform": [{"filter": {"field": "year", "oneOf": [1900, 1950, 2000]}}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-10', spec, opt).catch(console.err);
  });
</script>
</div><p>Finally, a <a class="reference internal" href="generated/core/altair.FieldRangePredicate.html#altair.FieldRangePredicate" title="altair.FieldRangePredicate"><code class="xref py py-meth docutils literal"><span class="pre">FieldRangePredicate()</span></code></a> allows selecting values within a
particular continuous range:</p>
<div class="highlight-python" id="transform-rst-altair-source-11"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">FieldRangePredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">1960</span><span class="p">,</span> <span class="mi">2000</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-11">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "transform": [{"filter": {"field": "year", "range": [1960, 2000]}}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-11', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="selection-predicates">
<h3>Selection Predicates<a class="headerlink" href="#selection-predicates" title="Permalink to this headline">¶</a></h3>
<p>Selection predicates can be used to filter data based on a selection. While
these can be constructed directly using a <a class="reference internal" href="generated/core/altair.SelectionPredicate.html#altair.SelectionPredicate" title="altair.SelectionPredicate"><code class="xref py py-class docutils literal"><span class="pre">SelectionPredicate</span></code></a> class,
in Altair it is often more convenient to construct them using the
<a class="reference internal" href="generated/api/altair.selection.html#altair.selection" title="altair.selection"><code class="xref py py-func docutils literal"><span class="pre">selection()</span></code></a> function. For example, this chart uses a multi-selection
that allows the user to click or shift-click on the bars in the bottom chart
to select the data to be shown in the top chart:</p>
<div class="highlight-python" id="transform-rst-altair-source-12"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">selection</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_multi</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>

<span class="n">top</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">selection</span>
<span class="p">)</span>

<span class="n">bottom</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;steelblue&#39;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;lightgray&#39;</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">selection</span><span class="o">=</span><span class="n">selection</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">vconcat</span><span class="p">(</span>
    <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">pop</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-12">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "vconcat": [{"mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "height": 200, "transform": [{"filter": {"selection": "selector067"}}], "width": 600}, {"mark": "bar", "encoding": {"color": {"condition": {"value": "steelblue", "selection": "selector067"}, "value": "lightgray"}, "x": {"type": "ordinal", "field": "year"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "height": 100, "selection": {"selector067": {"type": "multi", "fields": ["year"]}}, "width": 600}], "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-12', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="logical-operands">
<h3>Logical Operands<a class="headerlink" href="#logical-operands" title="Permalink to this headline">¶</a></h3>
<p>At times it is useful to combine several types of predicates into a single
selection. This can be accomplished using the various logical operand classes:</p>
<ul class="simple">
<li><a class="reference internal" href="generated/core/altair.LogicalOrPredicate.html#altair.LogicalOrPredicate" title="altair.LogicalOrPredicate"><code class="xref py py-class docutils literal"><span class="pre">LogicalOrPredicate</span></code></a></li>
<li><a class="reference internal" href="generated/core/altair.LogicalAndPredicate.html#altair.LogicalAndPredicate" title="altair.LogicalAndPredicate"><code class="xref py py-class docutils literal"><span class="pre">LogicalAndPredicate</span></code></a></li>
<li><a class="reference internal" href="generated/core/altair.LogicalNotPredicate.html#altair.LogicalNotPredicate" title="altair.LogicalNotPredicate"><code class="xref py py-class docutils literal"><span class="pre">LogicalNotPredicate</span></code></a></li>
</ul>
<p>These are not yet part of the Altair interface
(see <a class="reference external" href="https://github.com/altair-viz/altair/pull/693">Issue 693</a>)
but can be constructed explicitly; for example, here we plot US population
distributions for all data <em>except</em> the years 1950-1960,
by applying a <code class="docutils literal"><span class="pre">LogicalNotPredicate</span></code> schema to a <code class="docutils literal"><span class="pre">FieldRangePredicate</span></code>:</p>
<div class="highlight-python" id="transform-rst-altair-source-13"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;not&#39;</span><span class="p">:</span> <span class="n">alt</span><span class="o">.</span><span class="n">FieldRangePredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">1900</span><span class="p">,</span> <span class="mi">1950</span><span class="p">])}</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-13">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "height": 200, "transform": [{"filter": {"not": {"field": "year", "range": [1900, 1950]}}}], "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-13', spec, opt).catch(console.err);
  });
</script>
</div></div>
</div>
<div class="section" id="lookup-transform">
<span id="user-guide-lookup-transform"></span><h2>Lookup Transform<a class="headerlink" href="#lookup-transform" title="Permalink to this headline">¶</a></h2>
<p>The lookup transform extends a primary data source by looking up values from
another data source; it is similar to a one-sided join. A lookup can be added
at the top level of a chart using the <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_lookup" title="altair.Chart.transform_lookup"><code class="xref py py-meth docutils literal"><span class="pre">Chart.transform_lookup()</span></code></a> method.</p>
<p>By way of example, imagine you have two sources of data that you would like
to combine and plot: one is a list of names of people along with their height
and weight, and the other is some information about which groups they belong
to. This example data is available in <code class="docutils literal"><span class="pre">vega_datasets</span></code>:</p>
<div class="highlight-python" id="transform-rst-altair-source-14"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">people</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lookup_people</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lookup_groups</span><span class="p">()</span>
</pre></div>
</div>
<p>We know how to visualize each of these datasets separately; for example:</p>
<div class="highlight-python" id="transform-rst-altair-source-15"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">people</span><span class="p">)</span><span class="o">.</span><span class="n">mark_square</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;age:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;height:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;name:N&#39;</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;name:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span>

<span class="n">bottom</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rect</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;person:N&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;group:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">vconcat</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-15">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "vconcat": [{"data": {"name": "data-59fcb3ae476d760b9995707aff1a6876"}, "mark": {"type": "square", "size": 200}, "encoding": {"color": {"type": "nominal", "field": "name"}, "tooltip": {"type": "nominal", "field": "name"}, "x": {"type": "quantitative", "field": "age", "scale": {"zero": false}}, "y": {"type": "quantitative", "field": "height", "scale": {"zero": false}}}, "height": 200, "width": 400}, {"data": {"name": "data-733965e67b2edf1f86cd8d2aa1bfc4e1"}, "mark": "rect", "encoding": {"x": {"type": "nominal", "field": "person"}, "y": {"type": "ordinal", "field": "group"}}, "height": 100, "width": 400}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json", "datasets": {"data-59fcb3ae476d760b9995707aff1a6876": [{"name": "Alan", "age": 25, "height": 180}, {"name": "George", "age": 32, "height": 174}, {"name": "Fred", "age": 39, "height": 182}, {"name": "Steve", "age": 42, "height": 161}, {"name": "Nick", "age": 23, "height": 180}, {"name": "Will", "age": 21, "height": 168}, {"name": "Cole", "age": 51, "height": 160}, {"name": "Rick", "age": 63, "height": 181}, {"name": "Tom", "age": 54, "height": 179}], "data-733965e67b2edf1f86cd8d2aa1bfc4e1": [{"group": 1, "person": "Alan"}, {"group": 1, "person": "George"}, {"group": 1, "person": "Fred"}, {"group": 2, "person": "Steve"}, {"group": 2, "person": "Nick"}, {"group": 2, "person": "Will"}, {"group": 3, "person": "Cole"}, {"group": 3, "person": "Rick"}, {"group": 3, "person": "Tom"}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-15', spec, opt).catch(console.err);
  });
</script>
</div><p>If we would like to plot features that reference both datasets (for example, the
average age within each group), we need to combine the two datasets.
This can be done either as a data preprocessing step, using tools available
in Pandas, or as part of the visualization using a <a class="reference internal" href="generated/core/altair.LookupTransform.html#altair.LookupTransform" title="altair.LookupTransform"><code class="xref py py-class docutils literal"><span class="pre">LookupTransform</span></code></a>
in Altair.</p>
<div class="section" id="combining-datasets-with-pandas-merge">
<h3>Combining Datasets with pandas.merge<a class="headerlink" href="#combining-datasets-with-pandas-merge" title="Permalink to this headline">¶</a></h3>
<p>Pandas provides a wide range of tools for merging and joining datasets; see
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/merging.html">Merge, Join, and Concatenate</a>
for some detailed examples.
For the above data, we can merge the data and create a combined chart as follows:</p>
<div class="highlight-python" id="transform-rst-altair-source-16"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                  <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean(age):Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;group:O&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-16">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"name": "data-012c730680c958500c1ff1e1531590f9"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "aggregate": "mean", "field": "age"}, "y": {"type": "ordinal", "field": "group"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json", "datasets": {"data-012c730680c958500c1ff1e1531590f9": [{"group": 1, "person": "Alan", "name": "Alan", "age": 25, "height": 180}, {"group": 1, "person": "George", "name": "George", "age": 32, "height": 174}, {"group": 1, "person": "Fred", "name": "Fred", "age": 39, "height": 182}, {"group": 2, "person": "Steve", "name": "Steve", "age": 42, "height": 161}, {"group": 2, "person": "Nick", "name": "Nick", "age": 23, "height": 180}, {"group": 2, "person": "Will", "name": "Will", "age": 21, "height": 168}, {"group": 3, "person": "Cole", "name": "Cole", "age": 51, "height": 160}, {"group": 3, "person": "Rick", "name": "Rick", "age": 63, "height": 181}, {"group": 3, "person": "Tom", "name": "Tom", "age": 54, "height": 179}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-16', spec, opt).catch(console.err);
  });
</script>
</div><p>We specify a left join, meaning that for each entry of the “person” column in
the groups, we seek the “name” column in people and add the entry to the data.
From this, we can easily create a bar chart representing the mean age in each group.</p>
</div>
<div class="section" id="combining-datasets-with-a-lookup-transform">
<h3>Combining Datasets with a Lookup Transform<a class="headerlink" href="#combining-datasets-with-a-lookup-transform" title="Permalink to this headline">¶</a></h3>
<p>For some data sources (e.g. data available at a URL, or data that is streaming),
it is desirable to have a means of joining data without having to download
it for pre-processing in Pandas.
This is where Altair’s <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_lookup" title="altair.Chart.transform_lookup"><code class="xref py py-meth docutils literal"><span class="pre">transform_lookup()</span></code></a> comes in.
To reproduce the above combined plot by combining datasets within the
chart specification itself, we can do the following:</p>
<div class="highlight-python" id="transform-rst-altair-source-17"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean(age):Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;group:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_lookup</span><span class="p">(</span>
    <span class="n">lookup</span><span class="o">=</span><span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">from_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">LookupData</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">people</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                         <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-17">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"name": "data-733965e67b2edf1f86cd8d2aa1bfc4e1"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "aggregate": "mean", "field": "age"}, "y": {"type": "ordinal", "field": "group"}}, "transform": [{"lookup": "person", "from": {"data": {"name": "data-59fcb3ae476d760b9995707aff1a6876"}, "key": "name", "fields": ["age", "height"]}}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json", "datasets": {"data-733965e67b2edf1f86cd8d2aa1bfc4e1": [{"group": 1, "person": "Alan"}, {"group": 1, "person": "George"}, {"group": 1, "person": "Fred"}, {"group": 2, "person": "Steve"}, {"group": 2, "person": "Nick"}, {"group": 2, "person": "Will"}, {"group": 3, "person": "Cole"}, {"group": 3, "person": "Rick"}, {"group": 3, "person": "Tom"}], "data-59fcb3ae476d760b9995707aff1a6876": [{"name": "Alan", "age": 25, "height": 180}, {"name": "George", "age": 32, "height": 174}, {"name": "Fred", "age": 39, "height": 182}, {"name": "Steve", "age": 42, "height": 161}, {"name": "Nick", "age": 23, "height": 180}, {"name": "Will", "age": 21, "height": 168}, {"name": "Cole", "age": 51, "height": 160}, {"name": "Rick", "age": 63, "height": 181}, {"name": "Tom", "age": 54, "height": 179}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-17', spec, opt).catch(console.err);
  });
</script>
</div><p>Here <code class="docutils literal"><span class="pre">lookup</span></code> names the field in the groups dataset on which we will match,
and the <code class="docutils literal"><span class="pre">from_</span></code> argument specifies a <a class="reference internal" href="generated/core/altair.LookupData.html#altair.LookupData" title="altair.LookupData"><code class="xref py py-class docutils literal"><span class="pre">LookupData</span></code></a> structure where
we supply the second dataset, the lookup key, and the fields we would like to
extract.</p>
</div>
<div class="section" id="example-lookup-transforms-for-geographical-visualization">
<h3>Example: Lookup Transforms for Geographical Visualization<a class="headerlink" href="#example-lookup-transforms-for-geographical-visualization" title="Permalink to this headline">¶</a></h3>
<p>Lookup transforms are often particularly important for geographic visualization,
where it is common to combine tabular datasets with datasets that specify
geographic boundaries to be visualized; for example, here is a visualization
of unemployment rates per county in the US:</p>
<div class="highlight-python" id="transform-rst-altair-source-18"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">counties</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">topo_feature</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">us_10m</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s1">&#39;counties&#39;</span><span class="p">)</span>
<span class="n">unemp_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unemployment</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">counties</span><span class="p">)</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rate:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_lookup</span><span class="p">(</span>
    <span class="n">lookup</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span>
    <span class="n">from_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">LookupData</span><span class="p">(</span><span class="n">unemp_data</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;albersUsa&#39;</span><span class="p">},</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-18">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/us-10m.json", "format": {"feature": "counties", "type": "topojson"}}, "mark": "geoshape", "encoding": {"color": {"type": "quantitative", "field": "rate"}}, "height": 300, "projection": {"type": "albersUsa"}, "transform": [{"lookup": "id", "from": {"data": {"url": "https://vega.github.io/vega-datasets/data/unemployment.tsv"}, "key": "id", "fields": ["rate"]}}], "width": 500, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-18', spec, opt).catch(console.err);
  });
</script>
</div></div>
</div>
<div class="section" id="timeunit-transform">
<span id="user-guide-timeunit-transform"></span><h2>TimeUnit Transform<a class="headerlink" href="#timeunit-transform" title="Permalink to this headline">¶</a></h2>
<p>TimeUnit transforms are used to discretize dates and times within Altair.
As with the <a class="reference internal" href="#user-guide-aggregate-transform"><span class="std std-ref">Aggregate Transforms</span></a> and <a class="reference internal" href="#user-guide-bin-transform"><span class="std std-ref">Bin transforms</span></a>
discussed above, they can be defined either as part of the encoding, or as a
top-level transform.</p>
<p>These are the available time units:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&quot;year&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearquarter&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearquartermonth&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearmonth&quot;</span></code>,
<code class="docutils literal"><span class="pre">&quot;yearmonthdate&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearmonthdatehours&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearmonthdatehoursminutes&quot;</span></code>,
<code class="docutils literal"><span class="pre">&quot;yearmonthdatehoursseconds&quot;</span></code>.</li>
<li><code class="docutils literal"><span class="pre">&quot;quarter&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;quartermonth&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;month&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;monthdate&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;date&quot;</span></code> (Day of month, i.e., 1 - 31)</li>
<li><code class="docutils literal"><span class="pre">&quot;day&quot;</span></code> (Day of week, i.e., Monday - Friday)</li>
<li><code class="docutils literal"><span class="pre">&quot;hours&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;hoursminutes&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;hoursminutesseconds&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;minutes&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;minutesseconds&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;seconds&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;secondsmilliseconds&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;milliseconds&quot;</span></code></li>
</ul>
<div class="section" id="timeunit-within-encoding">
<h3>TimeUnit Within Encoding<a class="headerlink" href="#timeunit-within-encoding" title="Permalink to this headline">¶</a></h3>
<p>Any temporal field definition can include a <code class="docutils literal"><span class="pre">timeUnit</span></code> argument to discretize
the temporal data.</p>
<p>For example, here we plot a dataset that consists of hourly temperature
measurements in Seattle during the year 2010:</p>
<div class="highlight-python" id="transform-rst-altair-source-19"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">temps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">seattle_temps</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;temp:Q&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-19">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "line", "encoding": {"x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "temp"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-19', spec, opt).catch(console.err);
  });
</script>
</div><p>The plot is too busy due to the amount of data points squeezed into the short
time; we can make it a bit cleaner by discretizing it, for example, by month
and plotting only the mean monthly temperature:</p>
<div class="highlight-python" id="transform-rst-altair-source-20"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(temp):Q&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-20">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "line", "encoding": {"x": {"type": "temporal", "field": "date", "timeUnit": "month"}, "y": {"type": "quantitative", "aggregate": "mean", "field": "temp"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-20', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice that by default timeUnit output is a continuous quantity; if you would
instead like it to be a categorical, you can specify the ordinal (<code class="docutils literal"><span class="pre">O</span></code>) or
nominal (<code class="docutils literal"><span class="pre">N</span></code>) type.
This can be useful when plotting a bar chart or other discrete chart type:</p>
<div class="highlight-python" id="transform-rst-altair-source-21"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(temp):Q&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-21">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "bar", "encoding": {"x": {"type": "ordinal", "field": "date", "timeUnit": "month"}, "y": {"type": "quantitative", "aggregate": "mean", "field": "temp"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-21', spec, opt).catch(console.err);
  });
</script>
</div><p>Multiple time units can be combined within a single plot to yield interesting
views of your data; for example, here we extract both the month and the day
to give a profile of Seattle temperatures through the year:</p>
<div class="highlight-python" id="transform-rst-altair-source-22"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rect</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;date(date):O&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;max(temp):Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;2010 Daily High Temperatures in Seattle (F)&quot;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-22">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "rect", "encoding": {"color": {"type": "quantitative", "aggregate": "max", "field": "temp"}, "x": {"type": "ordinal", "field": "date", "timeUnit": "date", "title": "day"}, "y": {"type": "ordinal", "field": "date", "timeUnit": "month", "title": "month"}}, "title": "2010 Daily High Temperatures in Seattle (F)", "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-22', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="timeunit-as-a-transform">
<h3>TimeUnit as a Transform<a class="headerlink" href="#timeunit-as-a-transform" title="Permalink to this headline">¶</a></h3>
<p>Other times it is convenient to specify a timeUnit as a top-level transform,
particularly when the value may be reused.
This can be done most conveniently using the <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_timeunit" title="altair.Chart.transform_timeunit"><code class="xref py py-meth docutils literal"><span class="pre">Chart.transform_timeunit()</span></code></a>
method. For example:</p>
<div class="highlight-python" id="transform-rst-altair-source-23"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month:T&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(temp):Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_timeunit</span><span class="p">(</span>
    <span class="n">month</span><span class="o">=</span><span class="s1">&#39;month(date)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-23">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "line", "encoding": {"x": {"type": "temporal", "axis": {"format": "%b"}, "field": "month"}, "y": {"type": "quantitative", "aggregate": "mean", "field": "temp"}}, "transform": [{"field": "date", "timeUnit": "month", "as": "month"}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-23', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice that because the <code class="docutils literal"><span class="pre">timeUnit</span></code> is not part of the encoding channel here,
it is often necessary to add an axis formatter to ensure appropriate axis
labels.</p>
</div>
</div>
<div class="section" id="window-transform">
<span id="user-guide-window-transform"></span><h2>Window Transform<a class="headerlink" href="#window-transform" title="Permalink to this headline">¶</a></h2>
<p>The window transform performs calculations over sorted groups of data objects.
These calculations include ranking, lead/lag analysis, and aggregates such as cumulative sums and averages.
Calculated values are written back to the input data stream, where they can be referenced by encodings.</p>
<p>For example, consider the following cumulative frequency distribution:</p>
<div class="highlight-python" id="transform-rst-altair-source-24"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
    <span class="n">sort</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;IMDB_Rating&#39;</span><span class="p">}],</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">cumulative_count</span><span class="o">=</span><span class="s1">&#39;count(*)&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;IMDB_Rating:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;cumulative_count:Q&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-24">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/movies.json"}, "mark": "area", "encoding": {"x": {"type": "quantitative", "field": "IMDB_Rating"}, "y": {"type": "quantitative", "field": "cumulative_count"}}, "transform": [{"window": [{"op": "count", "field": "*", "as": "cumulative_count"}], "frame": [null, 0], "sort": [{"field": "IMDB_Rating"}]}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-24', spec, opt).catch(console.err);
  });
</script>
</div><p>First, we pass a sort field definition, which indicates how data objects should be sorted within the window.
Here, movies should be sorted by their IMDB rating.
Next, we pass the frame, which indicates how many data objects before and after the current data object should be included within the window.
Here, all movies up to and including the current movie should be included.
Finally, we pass a window field definition, which indicates how data objects should be aggregated within the window.
Here, the number of movies should be counted.</p>
<p>There are many aggregation functions built into Altair.
As well as those given in <a class="reference internal" href="encoding.html#encoding-aggregates"><span class="std std-ref">Binning and Aggregation</span></a>, we can use the following within window field definitions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="3%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Aggregate</th>
<th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>row_number</td>
<td>None</td>
<td>Assigns each data object a consecutive row number, starting from 1.</td>
</tr>
<tr class="row-odd"><td>rank</td>
<td>None</td>
<td>Assigns a rank order value to each data object in a window, starting from 1. Peer values are assigned the same rank. Subsequent rank scores incorporate the number of prior values. For example, if the first two values tie for rank 1, the third value is assigned rank 3.</td>
</tr>
<tr class="row-even"><td>dense_rank</td>
<td>None</td>
<td>Assigns dense rank order values to each data object in a window, starting from 1. Peer values are assigned the same rank. Subsequent rank scores do not incorporate the number of prior values. For example, if the first two values tie for rank 1, the third value is assigned rank 2.</td>
</tr>
<tr class="row-odd"><td>percent_rank</td>
<td>None</td>
<td>Assigns a percentage rank order value to each data object in a window. The percent is calculated as (rank - 1) / (group_size - 1).</td>
</tr>
<tr class="row-even"><td>cume_dist</td>
<td>None</td>
<td>Assigns a cumulative distribution value between 0 and 1 to each data object in a window.</td>
</tr>
<tr class="row-odd"><td>ntile</td>
<td>Number</td>
<td>Assigns a quantile (e.g., percentile) value to each data object in a window. Accepts an integer parameter indicating the number of buckets to use (e.g., 100 for percentiles, 5 for quintiles).</td>
</tr>
<tr class="row-even"><td>lag</td>
<td>Number</td>
<td>Assigns a value from the data object that precedes the current object by a specified number of positions. If no such object exists, assigns <code class="docutils literal"><span class="pre">null</span></code>. Accepts an offset parameter (default <code class="docutils literal"><span class="pre">1</span></code>) that indicates the number of positions. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-odd"><td>lead</td>
<td>Number</td>
<td>Assigns a value from the data object that follows the current object by a specified number of positions. If no such object exists, assigns <code class="docutils literal"><span class="pre">null</span></code>. Accepts an offset parameter (default <code class="docutils literal"><span class="pre">1</span></code>) that indicates the number of positions. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-even"><td>first_value</td>
<td>None</td>
<td>Assigns a value from the first data object in the current sliding window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-odd"><td>last_value</td>
<td>None</td>
<td>Assigns a value from the last data object in the current sliding window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-even"><td>nth_value</td>
<td>Number</td>
<td>Assigns a value from the nth data object in the current sliding window frame. If no such object exists, assigns <code class="docutils literal"><span class="pre">null</span></code>. Requires a non-negative integer parameter that indicates the offset from the start of the window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
</tbody>
</table>
<p>While an aggregate transform computes a single value that summarises all data objects, a window transform adds a new property to each data object.
This new property is computed from the neighbouring data objects: that is, from the data objects delimited by the window field definition.
For example, consider the following time series of stock prices:</p>
<div class="highlight-python" id="transform-rst-altair-source-25"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">stocks</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;price:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;symbol:N&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-25">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/stocks.csv"}, "mark": "line", "encoding": {"color": {"type": "nominal", "field": "symbol"}, "x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "price"}}, "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-25', spec, opt).catch(console.err);
  });
</script>
</div><p>It’s hard to see the overall pattern in the above example, because Google’s stock price is much higher than the other stock prices.
If we plot the <a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Z-score">z-scores</a> of the stock prices, rather than the stock prices themselves, then the overall pattern becomes clearer:</p>
<div class="highlight-python" id="transform-rst-altair-source-26"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">stocks</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
    <span class="n">mean_price</span><span class="o">=</span><span class="s1">&#39;mean(price)&#39;</span><span class="p">,</span>
    <span class="n">stdev_price</span><span class="o">=</span><span class="s1">&#39;stdev(price)&#39;</span><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">z_score</span><span class="o">=</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">price</span> <span class="o">-</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">mean_price</span><span class="p">)</span> <span class="o">/</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">stdev_price</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;z_score:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;symbol:N&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-26">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}}, "data": {"url": "https://vega.github.io/vega-datasets/data/stocks.csv"}, "mark": "line", "encoding": {"color": {"type": "nominal", "field": "symbol"}, "x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "z_score"}}, "transform": [{"window": [{"op": "mean", "field": "price", "as": "mean_price"}, {"op": "stdev", "field": "price", "as": "stdev_price"}], "frame": [null, null], "groupby": ["symbol"]}, {"calculate": "((datum.price - datum.mean_price) / datum.stdev_price)", "as": "z_score"}], "$schema": "https://vega.github.io/schema/vega-lite/v2.6.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-26', spec, opt).catch(console.err);
  });
</script>
</div><p>By using two aggregation functions (<code class="docutils literal"><span class="pre">mean</span></code> and <code class="docutils literal"><span class="pre">stdev</span></code>) within the window transform, we are able to compute the z-scores within the calculate transform.</p>
<p>For more information about the arguments to the window transform, see <a class="reference internal" href="generated/core/altair.WindowTransform.html#altair.WindowTransform" title="altair.WindowTransform"><code class="xref py py-class docutils literal"><span class="pre">WindowTransform</span></code></a> and <a class="reference external" href="https://vega.github.io/vega-lite/docs/window.html">the Vega-Lite documentation</a>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interactions.html" class="btn btn-neutral float-right" title="Bindings, Selections, Conditions: Making Charts Interactive" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="marks.html" class="btn btn-neutral" title="Marks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Altair Developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'2.4.1',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@3.3"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@2.6"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@3.18"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>