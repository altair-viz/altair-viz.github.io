

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Data Transformations &mdash; Altair 3.2.0 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/altair-plot.css" type="text/css" />
  <link rel="stylesheet" href="../_static/altair-gallery.css" type="text/css" />
  <link rel="stylesheet" href="../_static/theme_overrides.css" type="text/css" />
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Bindings, Selections, Conditions: Making Charts Interactive" href="interactions.html" />
    <link rel="prev" title="Marks" href="marks.html" /> 

  
  <script src="../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Altair
          

          
            
            <img src="../_static/altair-logo-light.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                3.2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/overview.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../getting_started/starting.html">Basic Statistical Visualization</a></li>
</ul>
<p class="caption"><span class="caption-text">Gallery</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../gallery/index.html">Example Gallery</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="data.html">Specifying Data in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="encoding.html">Encodings</a></li>
<li class="toctree-l1"><a class="reference internal" href="marks.html">Marks</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Data Transformations</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#aggregate-transforms">Aggregate Transforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#transform-options">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#bin-transforms">Bin transforms</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#calculate-transform">Calculate Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id2">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#filter-transform">Filter Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#filter-expression">Filter Expression</a></li>
<li class="toctree-l3"><a class="reference internal" href="#field-predicates">Field Predicates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#selection-predicates">Selection Predicates</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logical-operands">Logical Operands</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#flatten-transform">Flatten Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id4">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#fold-transform">Fold Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id5">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#impute-transform">Impute Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#impute-via-encodings">Impute via Encodings</a></li>
<li class="toctree-l3"><a class="reference internal" href="#impute-via-transform">Impute via Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#join-aggregate-transform">Join Aggregate Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id7">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#lookup-transform">Lookup Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#combining-datasets-with-pandas-merge">Combining Datasets with pandas.merge</a></li>
<li class="toctree-l3"><a class="reference internal" href="#combining-datasets-with-a-lookup-transform">Combining Datasets with a Lookup Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#example-lookup-transforms-for-geographical-visualization">Example: Lookup Transforms for Geographical Visualization</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id8">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#sample-transform">Sample Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id9">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#stack-transform">Stack Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id10">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#timeunit-transform">TimeUnit Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#timeunit-within-encoding">TimeUnit Within Encoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="#timeunit-as-a-transform">TimeUnit as a Transform</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id11">Transform Options</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#window-transform">Window Transform</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id12">Transform Options</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="interactions.html">Bindings, Selections, Conditions: Making Charts Interactive</a></li>
<li class="toctree-l1"><a class="reference internal" href="configuration.html">Top-Level Chart Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="compound_charts.html">Compound Charts: Layer, HConcat, VConcat, Repeat, Facet</a></li>
<li class="toctree-l1"><a class="reference internal" href="scale_resolve.html">Scale and Guide Resolution</a></li>
<li class="toctree-l1"><a class="reference internal" href="saving_charts.html">Saving Altair Charts</a></li>
<li class="toctree-l1"><a class="reference internal" href="customization.html">Customizing Visualizations</a></li>
<li class="toctree-l1"><a class="reference internal" href="times_and_dates.html">Times and Dates in Altair</a></li>
<li class="toctree-l1"><a class="reference internal" href="faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="troubleshooting.html">Display Troubleshooting</a></li>
<li class="toctree-l1"><a class="reference internal" href="renderers.html">Altair Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="internals.html">Altair Internals: Understanding the Library</a></li>
<li class="toctree-l1"><a class="reference internal" href="API.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="ecosystem.html">Altair Ecosystem</a></li>
</ul>
<p class="caption"><span class="caption-text">Case Studies</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../case_studies/exploring-weather.html">Exploring Seattle Weather</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="importing.html">Importing Vega &amp; Vega-Lite Versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="display_frontends.html">Displaying Charts in Various Frontends</a></li>
<li class="toctree-l1"><a class="reference internal" href="custom_renderers.html">Customizing Renderers</a></li>
<li class="toctree-l1"><a class="reference internal" href="data_transformers.html">Data transformers</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Altair</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
      <li>Data Transformations</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/user_guide/transform.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="data-transformations">
<span id="user-guide-transformations"></span><h1>Data Transformations<a class="headerlink" href="#data-transformations" title="Permalink to this headline">¶</a></h1>
<p>It is often necessary to transform or filter data in the process of visualizing
it. In Altair you can do this one of two ways:</p>
<ol class="arabic simple">
<li>Before the chart definition, using standard Pandas data transformations.</li>
<li>Within the chart definition, using Vega-Lite’s data transformation tools.</li>
</ol>
<p>In most cases, we suggest that you use the first approach, because it is more
straightforward to those who are familiar with data manipulation in Python, and
because the Pandas package offers much more flexibility than Vega-Lite in
available data manipulations.</p>
<p>The second approach becomes useful when the data source is not a dataframe, but,
for example, a URL pointer to a JSON or CSV file. It can also be useful in a
compound chart where different views of the dataset require different
transformations.</p>
<p>This second approach – specifying data transformations within the chart
specification itself – can be accomplished using the <code class="docutils literal"><span class="pre">transform_*</span></code>
methods of top-level objects:</p>
<table border="1" class="docutils">
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="49%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Transform</th>
<th class="head">Method</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><a class="reference internal" href="#user-guide-aggregate-transform"><span class="std std-ref">Aggregate Transforms</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_aggregate" title="altair.Chart.transform_aggregate"><code class="xref py py-meth docutils literal"><span class="pre">transform_aggregate()</span></code></a></td>
<td>Create a new data column by aggregating an existing column.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#user-guide-bin-transform"><span class="std std-ref">Bin transforms</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_bin" title="altair.Chart.transform_bin"><code class="xref py py-meth docutils literal"><span class="pre">transform_bin()</span></code></a></td>
<td>Create a new data column by binning an existing column.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#user-guide-calculate-transform"><span class="std std-ref">Calculate Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_calculate" title="altair.Chart.transform_calculate"><code class="xref py py-meth docutils literal"><span class="pre">transform_calculate()</span></code></a></td>
<td>Create a new data column using an arithmetic calculation on an existing column.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#user-guide-filter-transform"><span class="std std-ref">Filter Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_filter" title="altair.Chart.transform_filter"><code class="xref py py-meth docutils literal"><span class="pre">transform_filter()</span></code></a></td>
<td>Select a subset of data based on a condition.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#user-guide-flatten-transform"><span class="std std-ref">Flatten Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_flatten" title="altair.Chart.transform_flatten"><code class="xref py py-meth docutils literal"><span class="pre">transform_flatten()</span></code></a></td>
<td>Flatten array data into columns.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#user-guide-fold-transform"><span class="std std-ref">Fold Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_fold" title="altair.Chart.transform_fold"><code class="xref py py-meth docutils literal"><span class="pre">transform_fold()</span></code></a></td>
<td>Convert wide-form data into long-form data.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#user-guide-impute-transform"><span class="std std-ref">Impute Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_impute" title="altair.Chart.transform_impute"><code class="xref py py-meth docutils literal"><span class="pre">transform_impute()</span></code></a></td>
<td>Impute missing data.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#user-guide-joinaggregate-transform"><span class="std std-ref">Join Aggregate Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_joinaggregate" title="altair.Chart.transform_joinaggregate"><code class="xref py py-meth docutils literal"><span class="pre">transform_joinaggregate()</span></code></a></td>
<td>Aggregate transform joined to original data.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#user-guide-lookup-transform"><span class="std std-ref">Lookup Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_lookup" title="altair.Chart.transform_lookup"><code class="xref py py-meth docutils literal"><span class="pre">transform_lookup()</span></code></a></td>
<td>One-sided join of two datasets based on a lookup key.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#user-guide-sample-transform"><span class="std std-ref">Sample Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_sample" title="altair.Chart.transform_sample"><code class="xref py py-meth docutils literal"><span class="pre">transform_sample()</span></code></a></td>
<td>Random sub-sample of the rows in the dataset.</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#user-guide-stack-transform"><span class="std std-ref">Stack Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_stack" title="altair.Chart.transform_stack"><code class="xref py py-meth docutils literal"><span class="pre">transform_stack()</span></code></a></td>
<td>Compute stacked version of values.</td>
</tr>
<tr class="row-odd"><td><a class="reference internal" href="#user-guide-timeunit-transform"><span class="std std-ref">TimeUnit Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_timeunit" title="altair.Chart.transform_timeunit"><code class="xref py py-meth docutils literal"><span class="pre">transform_timeunit()</span></code></a></td>
<td>Discretize/group a date by a time unit (day, month, year, etc.)</td>
</tr>
<tr class="row-even"><td><a class="reference internal" href="#user-guide-window-transform"><span class="std std-ref">Window Transform</span></a></td>
<td><a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_window" title="altair.Chart.transform_window"><code class="xref py py-meth docutils literal"><span class="pre">transform_window()</span></code></a></td>
<td>Compute a windowed aggregation</td>
</tr>
</tbody>
</table>
<p>We will see some examples of these transforms in the following sections.</p>
<div class="section" id="aggregate-transforms">
<span id="user-guide-aggregate-transform"></span><h2>Aggregate Transforms<a class="headerlink" href="#aggregate-transforms" title="Permalink to this headline">¶</a></h2>
<p>There are two ways to aggregate data within Altair: within the encoding itself,
or using a top level aggregate transform.</p>
<p>The aggregate property of a field definition can be used to compute aggregate
summary statistics (e.g., median, min, max) over groups of data.</p>
<p>If at least one fields in the specified encoding channels contain aggregate,
the resulting visualization will show aggregate data. In this case, all
fields without aggregation function specified are treated as group-by fields
in the aggregation process.</p>
<p>For example, the following bar chart aggregates mean of <code class="docutils literal"><span class="pre">acceleration</span></code>,
grouped by the number of Cylinders.</p>
<div class="highlight-python" id="transform-rst-altair-source-0"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">cars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cars</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Cylinders:O&#39;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean(Acceleration):Q&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-0">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "aggregate": "mean", "field": "Acceleration"}, "y": {"type": "ordinal", "field": "Cylinders"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-0', spec, opt).catch(console.err);
  });
</script>
</div><p>The Altair shorthand string:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(acceleration):Q&#39;</span><span class="p">,</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>is made available for convenience, and is equivalent to the longer form:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># ...</span>
<span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;acceleration&#39;</span><span class="p">,</span> <span class="n">aggregate</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="s1">&#39;quantitative&#39;</span><span class="p">),</span>
<span class="c1"># ...</span>
</pre></div>
</div>
<p>For more information on shorthand encodings specifications, see
<a class="reference internal" href="encoding.html#encoding-aggregates"><span class="std std-ref">Binning and Aggregation</span></a>.</p>
<p>The same plot can be shown using an explicitly computed aggregation, using the
<a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_aggregate" title="altair.Chart.transform_aggregate"><code class="xref py py-meth docutils literal"><span class="pre">transform_aggregate()</span></code></a> method:</p>
<div class="highlight-python" id="transform-rst-altair-source-1"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Cylinders:O&#39;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean_acc:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_aggregate</span><span class="p">(</span>
    <span class="n">mean_acc</span><span class="o">=</span><span class="s1">&#39;mean(Acceleration)&#39;</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Cylinders&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-1">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "field": "mean_acc"}, "y": {"type": "ordinal", "field": "Cylinders"}}, "transform": [{"aggregate": [{"op": "mean", "field": "Acceleration", "as": "mean_acc"}], "groupby": ["Cylinders"]}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-1', spec, opt).catch(console.err);
  });
</script>
</div><p>For a list of available aggregates, see <a class="reference internal" href="encoding.html#encoding-aggregates"><span class="std std-ref">Binning and Aggregation</span></a>.</p>
<div class="section" id="transform-options">
<h3>Transform Options<a class="headerlink" href="#transform-options" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_aggregate" title="altair.Chart.transform_aggregate"><code class="xref py py-meth docutils literal"><span class="pre">transform_aggregate()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.AggregateTransform.html#altair.AggregateTransform" title="altair.AggregateTransform"><code class="xref py py-class docutils literal"><span class="pre">AggregateTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">aggregate</td>
<td>array(<a class="reference internal" href="generated/core/altair.AggregatedFieldDef.html#altair.AggregatedFieldDef" title="altair.AggregatedFieldDef"><code class="xref py py-class docutils literal"><span class="pre">AggregatedFieldDef</span></code></a>)</td>
<td class="vl-decsr">Array of objects that define fields to aggregate.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">groupby</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr">The data fields to group by. If not specified, a single group containing all data objects will be used.</td>
</tr>
</tbody>
</table>
<p>The <a class="reference internal" href="generated/core/altair.AggregatedFieldDef.html#altair.AggregatedFieldDef" title="altair.AggregatedFieldDef"><code class="xref py py-class docutils literal"><span class="pre">AggregatedFieldDef</span></code></a> objects have the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The output field names to use for each aggregated field.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">field</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The data field for which to compute aggregate function. This is required for all aggregation operations except <code class="docutils literal"><span class="pre">&quot;count&quot;</span></code>.</td>
</tr>
<tr class="row-even"><td class="vl-prop">op</td>
<td><a class="reference internal" href="generated/core/altair.AggregateOp.html#altair.AggregateOp" title="altair.AggregateOp"><code class="xref py py-class docutils literal"><span class="pre">AggregateOp</span></code></a></td>
<td class="vl-decsr">The aggregation operation to apply to the fields (e.g., sum, average or count).
See the <a class="reference external" href="https://vega.github.io/vega-lite/docs/aggregate.html#ops">full list of supported aggregation operations</a>
for more information.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="bin-transforms">
<span id="user-guide-bin-transform"></span><h2>Bin transforms<a class="headerlink" href="#bin-transforms" title="Permalink to this headline">¶</a></h2>
<p>As with <a class="reference internal" href="#user-guide-aggregate-transform"><span class="std std-ref">Aggregate Transforms</span></a>, there are two ways to apply
a bin transform in Altair: within the encoding itself, or using a top-level
bin transform.</p>
<p>An common application of a bin transform is when creating a histogram:</p>
<div class="highlight-python" id="transform-rst-altair-source-2"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">movies</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s2">&quot;IMDB_Rating:Q&quot;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count()&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-2">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/movies.json"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "bin": true, "field": "IMDB_Rating"}, "y": {"type": "quantitative", "aggregate": "count"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-2', spec, opt).catch(console.err);
  });
</script>
</div><p>But a bin transform can be useful in other applications; for example, here we
bin a continuous field to create a discrete color map:</p>
<div class="highlight-python" id="transform-rst-altair-source-3"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">cars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cars</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Horsepower:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Miles_per_Gallon:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Color</span><span class="p">(</span><span class="s1">&#39;Acceleration:Q&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">maxbins</span><span class="o">=</span><span class="mi">5</span><span class="p">))</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-3">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "point", "encoding": {"color": {"type": "quantitative", "bin": {"maxbins": 5}, "field": "Acceleration"}, "x": {"type": "quantitative", "field": "Horsepower"}, "y": {"type": "quantitative", "field": "Miles_per_Gallon"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-3', spec, opt).catch(console.err);
  });
</script>
</div><p>In the first case we set <code class="docutils literal"><span class="pre">bin</span> <span class="pre">=</span> <span class="pre">True</span></code>, which uses the default bin settings.
In the second case, we exercise more fine-tuned control over the bin parameters
by passing a <code class="xref py py-class docutils literal"><span class="pre">Bin</span></code> object.</p>
<p>If you are using the same binnings in multiple chart components, it can be useful
to instead define the binning at the top level, using <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_bin" title="altair.Chart.transform_bin"><code class="xref py py-meth docutils literal"><span class="pre">transform_bin()</span></code></a>
method.</p>
<p>Here is the above histogram created using a top-level bin transform:</p>
<div class="highlight-python" id="transform-rst-altair-source-4"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">movies</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">movies</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;binned_rating:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;count()&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_bin</span><span class="p">(</span>
    <span class="s1">&#39;binned_rating&#39;</span><span class="p">,</span> <span class="n">field</span><span class="o">=</span><span class="s1">&#39;IMDB_Rating&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-4">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/movies.json"}, "mark": "bar", "encoding": {"x": {"type": "ordinal", "field": "binned_rating"}, "y": {"type": "quantitative", "aggregate": "count"}}, "transform": [{"bin": true, "field": "IMDB_Rating", "as": "binned_rating"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-4', spec, opt).catch(console.err);
  });
</script>
</div><p>And here is the transformed color scale using a top-level bin transform:</p>
<div class="highlight-python" id="transform-rst-altair-source-5"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">cars</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cars</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">cars</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Horsepower:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Miles_per_Gallon:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;binned_acc:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_bin</span><span class="p">(</span>
    <span class="s1">&#39;binned_acc&#39;</span><span class="p">,</span> <span class="s1">&#39;Acceleration&#39;</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Bin</span><span class="p">(</span><span class="n">maxbins</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-5">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "mark": "point", "encoding": {"color": {"type": "ordinal", "field": "binned_acc"}, "x": {"type": "quantitative", "field": "Horsepower"}, "y": {"type": "quantitative", "field": "Miles_per_Gallon"}}, "transform": [{"bin": {"maxbins": 5}, "field": "Acceleration", "as": "binned_acc"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-5', spec, opt).catch(console.err);
  });
</script>
</div><p>The advantage of the top-level transform is that the same named field can be
used in multiple places in the chart if desired.
Note the slight difference in binning behavior between the encoding-based binnings
(which preserve the range of the bins) and the transform-based binnings (which
collapse each bin to a single representative value.</p>
<div class="section" id="id1">
<h3>Transform Options<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_bin" title="altair.Chart.transform_bin"><code class="xref py py-meth docutils literal"><span class="pre">transform_bin()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.BinTransform.html#altair.BinTransform" title="altair.BinTransform"><code class="xref py py-class docutils literal"><span class="pre">BinTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td>anyOf(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>, array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>))</td>
<td class="vl-decsr">The output fields at which to write the start and end bin values.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">bin</td>
<td>anyOf([True], <a class="reference internal" href="generated/core/altair.BinParams.html#altair.BinParams" title="altair.BinParams"><code class="xref py py-class docutils literal"><span class="pre">BinParams</span></code></a>)</td>
<td class="vl-decsr">An object indicating bin properties, or simply <code class="docutils literal"><span class="pre">true</span></code> for using default bin parameters.</td>
</tr>
<tr class="row-even"><td class="vl-prop">field</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The data field to bin.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="calculate-transform">
<span id="user-guide-calculate-transform"></span><h2>Calculate Transform<a class="headerlink" href="#calculate-transform" title="Permalink to this headline">¶</a></h2>
<p>The calculate transform allows the user to define new fields in the dataset
which are calculated from other fields using an expression syntax.</p>
<p>As a simple example, here we take data with a simple input sequence, and compute
a some trigonometric quantities:</p>
<div class="highlight-python" id="transform-rst-altair-source-6"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">)})</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y:Q&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;cos(datum.t * PI / 50)&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sin(datum.t * PI / 25)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-6">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-154c237c455a7f8fb343ee63b47dd948"}, "mark": "line", "encoding": {"order": {"type": "quantitative", "field": "t"}, "x": {"type": "quantitative", "field": "x"}, "y": {"type": "quantitative", "field": "y"}}, "transform": [{"calculate": "cos(datum.t * PI / 50)", "as": "x"}, {"calculate": "sin(datum.t * PI / 25)", "as": "y"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-154c237c455a7f8fb343ee63b47dd948": [{"t": 0}, {"t": 1}, {"t": 2}, {"t": 3}, {"t": 4}, {"t": 5}, {"t": 6}, {"t": 7}, {"t": 8}, {"t": 9}, {"t": 10}, {"t": 11}, {"t": 12}, {"t": 13}, {"t": 14}, {"t": 15}, {"t": 16}, {"t": 17}, {"t": 18}, {"t": 19}, {"t": 20}, {"t": 21}, {"t": 22}, {"t": 23}, {"t": 24}, {"t": 25}, {"t": 26}, {"t": 27}, {"t": 28}, {"t": 29}, {"t": 30}, {"t": 31}, {"t": 32}, {"t": 33}, {"t": 34}, {"t": 35}, {"t": 36}, {"t": 37}, {"t": 38}, {"t": 39}, {"t": 40}, {"t": 41}, {"t": 42}, {"t": 43}, {"t": 44}, {"t": 45}, {"t": 46}, {"t": 47}, {"t": 48}, {"t": 49}, {"t": 50}, {"t": 51}, {"t": 52}, {"t": 53}, {"t": 54}, {"t": 55}, {"t": 56}, {"t": 57}, {"t": 58}, {"t": 59}, {"t": 60}, {"t": 61}, {"t": 62}, {"t": 63}, {"t": 64}, {"t": 65}, {"t": 66}, {"t": 67}, {"t": 68}, {"t": 69}, {"t": 70}, {"t": 71}, {"t": 72}, {"t": 73}, {"t": 74}, {"t": 75}, {"t": 76}, {"t": 77}, {"t": 78}, {"t": 79}, {"t": 80}, {"t": 81}, {"t": 82}, {"t": 83}, {"t": 84}, {"t": 85}, {"t": 86}, {"t": 87}, {"t": 88}, {"t": 89}, {"t": 90}, {"t": 91}, {"t": 92}, {"t": 93}, {"t": 94}, {"t": 95}, {"t": 96}, {"t": 97}, {"t": 98}, {"t": 99}, {"t": 100}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-6', spec, opt).catch(console.err);
  });
</script>
</div><p>Each argument within <code class="docutils literal"><span class="pre">transform_calculate</span></code> is a <a class="reference external" href="https://vega.github.io/vega/docs/expressions/">Vega expression</a> string,
which is a well-defined set of javascript-style operations that can be used
to calculate a new field from an existing one.</p>
<p>To streamline building these vega expressions in Python, Altair provides the
<code class="xref py py-mod docutils literal"><span class="pre">altair.expr</span></code> module which provides constants and functions to allow
these expressions to be constructed with Python syntax; for example:</p>
<div class="highlight-python" id="transform-rst-altair-source-7"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">altair</span> <span class="kn">import</span> <span class="n">expr</span><span class="p">,</span> <span class="n">datum</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;x:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;y:Q&#39;</span><span class="p">,</span>
    <span class="n">order</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="n">expr</span><span class="o">.</span><span class="n">PI</span> <span class="o">/</span> <span class="mi">50</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">expr</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">t</span> <span class="o">*</span> <span class="n">expr</span><span class="o">.</span><span class="n">PI</span> <span class="o">/</span> <span class="mi">25</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-7">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-154c237c455a7f8fb343ee63b47dd948"}, "mark": "line", "encoding": {"order": {"type": "quantitative", "field": "t"}, "x": {"type": "quantitative", "field": "x"}, "y": {"type": "quantitative", "field": "y"}}, "transform": [{"calculate": "cos(((datum.t * PI) / 50))", "as": "x"}, {"calculate": "sin(((datum.t * PI) / 25))", "as": "y"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-154c237c455a7f8fb343ee63b47dd948": [{"t": 0}, {"t": 1}, {"t": 2}, {"t": 3}, {"t": 4}, {"t": 5}, {"t": 6}, {"t": 7}, {"t": 8}, {"t": 9}, {"t": 10}, {"t": 11}, {"t": 12}, {"t": 13}, {"t": 14}, {"t": 15}, {"t": 16}, {"t": 17}, {"t": 18}, {"t": 19}, {"t": 20}, {"t": 21}, {"t": 22}, {"t": 23}, {"t": 24}, {"t": 25}, {"t": 26}, {"t": 27}, {"t": 28}, {"t": 29}, {"t": 30}, {"t": 31}, {"t": 32}, {"t": 33}, {"t": 34}, {"t": 35}, {"t": 36}, {"t": 37}, {"t": 38}, {"t": 39}, {"t": 40}, {"t": 41}, {"t": 42}, {"t": 43}, {"t": 44}, {"t": 45}, {"t": 46}, {"t": 47}, {"t": 48}, {"t": 49}, {"t": 50}, {"t": 51}, {"t": 52}, {"t": 53}, {"t": 54}, {"t": 55}, {"t": 56}, {"t": 57}, {"t": 58}, {"t": 59}, {"t": 60}, {"t": 61}, {"t": 62}, {"t": 63}, {"t": 64}, {"t": 65}, {"t": 66}, {"t": 67}, {"t": 68}, {"t": 69}, {"t": 70}, {"t": 71}, {"t": 72}, {"t": 73}, {"t": 74}, {"t": 75}, {"t": 76}, {"t": 77}, {"t": 78}, {"t": 79}, {"t": 80}, {"t": 81}, {"t": 82}, {"t": 83}, {"t": 84}, {"t": 85}, {"t": 86}, {"t": 87}, {"t": 88}, {"t": 89}, {"t": 90}, {"t": 91}, {"t": 92}, {"t": 93}, {"t": 94}, {"t": 95}, {"t": 96}, {"t": 97}, {"t": 98}, {"t": 99}, {"t": 100}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-7', spec, opt).catch(console.err);
  });
</script>
</div><p>Altair expressions are designed to output valid Vega expressions. The benefit of
using them is that proper syntax is ensured by the Python interpreter, and tab
completion of the <code class="xref py py-mod docutils literal"><span class="pre">expr</span></code> submodule can be used to explore the
available functions and constants.</p>
<p>These expressions can also be used when constructing a
<a class="reference internal" href="#user-guide-filter-transform"><span class="std std-ref">Filter Transform</span></a>, as we shall see next.</p>
<div class="section" id="id2">
<h3>Transform Options<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_calculate" title="altair.Chart.transform_calculate"><code class="xref py py-meth docutils literal"><span class="pre">transform_calculate()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.CalculateTransform.html#altair.CalculateTransform" title="altair.CalculateTransform"><code class="xref py py-class docutils literal"><span class="pre">CalculateTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The field for storing the computed formula value.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">calculate</td>
<td><code class="docutils literal"><span class="pre">string</span></code></td>
<td class="vl-decsr">A <a class="reference external" href="https://vega.github.io/vega-lite/docs/types.html#expression">expression</a> string. Use the variable <code class="docutils literal"><span class="pre">datum</span></code> to refer to the current data object.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="filter-transform">
<span id="user-guide-filter-transform"></span><h2>Filter Transform<a class="headerlink" href="#filter-transform" title="Permalink to this headline">¶</a></h2>
<p>The filter transform removes objects from a data stream based on a provided
filter expression, selection, or other filter predicate. A filter can be
added at the top level of a chart using the <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_filter" title="altair.Chart.transform_filter"><code class="xref py py-meth docutils literal"><span class="pre">Chart.transform_filter()</span></code></a>
method. The argument to <code class="docutils literal"><span class="pre">transform_filter</span></code> can be one of a number of
expressions and objects:</p>
<ol class="arabic simple">
<li>A <a class="reference external" href="https://vega.github.io/vega/docs/expressions/">Vega expression</a> expressed as a string or built using the <code class="xref py py-mod docutils literal"><span class="pre">expr</span></code> module</li>
<li>A Field predicate, such as <a class="reference internal" href="generated/core/altair.FieldOneOfPredicate.html#altair.FieldOneOfPredicate" title="altair.FieldOneOfPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldOneOfPredicate</span></code></a>,
<a class="reference internal" href="generated/core/altair.FieldRangePredicate.html#altair.FieldRangePredicate" title="altair.FieldRangePredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldRangePredicate</span></code></a>, <a class="reference internal" href="generated/core/altair.FieldEqualPredicate.html#altair.FieldEqualPredicate" title="altair.FieldEqualPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldEqualPredicate</span></code></a>,
<a class="reference internal" href="generated/core/altair.FieldLTPredicate.html#altair.FieldLTPredicate" title="altair.FieldLTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTPredicate</span></code></a>, <a class="reference internal" href="generated/core/altair.FieldGTPredicate.html#altair.FieldGTPredicate" title="altair.FieldGTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTPredicate</span></code></a>,
<a class="reference internal" href="generated/core/altair.FieldLTEPredicate.html#altair.FieldLTEPredicate" title="altair.FieldLTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTEPredicate</span></code></a>, <a class="reference internal" href="generated/core/altair.FieldGTEPredicate.html#altair.FieldGTEPredicate" title="altair.FieldGTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTEPredicate</span></code></a>,</li>
<li>A Selection predicate or object created by <a class="reference internal" href="generated/api/altair.selection.html#altair.selection" title="altair.selection"><code class="xref py py-func docutils literal"><span class="pre">selection()</span></code></a></li>
<li>A Logical operand that combines any of the above</li>
</ol>
<p>We’ll show a brief example of each of these in the following sections</p>
<div class="section" id="filter-expression">
<h3>Filter Expression<a class="headerlink" href="#filter-expression" title="Permalink to this headline">¶</a></h3>
<p>A filter expression uses the <a class="reference external" href="https://vega.github.io/vega/docs/expressions/">Vega expression</a> language, either specified
directly as a string, or built using the <code class="xref py py-mod docutils literal"><span class="pre">expr</span></code> module.
This can be useful when, for example, selecting only a subset of data.</p>
<p>For example:</p>
<div class="highlight-python" id="transform-rst-altair-source-8"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">altair</span> <span class="kn">import</span> <span class="n">datum</span>

<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;people:Q&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">year</span> <span class="o">==</span> <span class="mi">2000</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">datum</span><span class="o">.</span><span class="n">sex</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-8">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "area", "encoding": {"x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "field": "people"}}, "transform": [{"filter": "((datum.year === 2000) && (datum.sex === 1))"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-8', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice that, like in the <a class="reference internal" href="#user-guide-filter-transform"><span class="std std-ref">Filter Transform</span></a>, data values are
referenced via the name <code class="docutils literal"><span class="pre">datum</span></code>.</p>
</div>
<div class="section" id="field-predicates">
<h3>Field Predicates<a class="headerlink" href="#field-predicates" title="Permalink to this headline">¶</a></h3>
<p>Field predicates overlap somewhat in function with expression predicates, but
have the advantage that their contents are validated by the schema. Examples
are:</p>
<ul class="simple">
<li><a class="reference internal" href="generated/core/altair.FieldEqualPredicate.html#altair.FieldEqualPredicate" title="altair.FieldEqualPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldEqualPredicate</span></code></a> evaluates whether a field is equal to
a particular value</li>
<li><a class="reference internal" href="generated/core/altair.FieldOneOfPredicate.html#altair.FieldOneOfPredicate" title="altair.FieldOneOfPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldOneOfPredicate</span></code></a> evaluates whether a field is among a list of
specified values.</li>
<li><a class="reference internal" href="generated/core/altair.FieldRangePredicate.html#altair.FieldRangePredicate" title="altair.FieldRangePredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldRangePredicate</span></code></a> evaluates whether a continuous field is within
a range of values.</li>
<li><a class="reference internal" href="generated/core/altair.FieldLTPredicate.html#altair.FieldLTPredicate" title="altair.FieldLTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTPredicate</span></code></a> evaluates whether a continuous field is less
than a given value</li>
<li><a class="reference internal" href="generated/core/altair.FieldGTPredicate.html#altair.FieldGTPredicate" title="altair.FieldGTPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTPredicate</span></code></a> evaluates whether a continuous field is greater
than a given value</li>
<li><a class="reference internal" href="generated/core/altair.FieldLTEPredicate.html#altair.FieldLTEPredicate" title="altair.FieldLTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldLTEPredicate</span></code></a> evaluates whether a continuous field is less
than or equal to a given value</li>
<li><a class="reference internal" href="generated/core/altair.FieldGTEPredicate.html#altair.FieldGTEPredicate" title="altair.FieldGTEPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldGTEPredicate</span></code></a> evaluates whether a continuous field is greater
than or equal to a given value</li>
</ul>
<p>Here is an example of a <a class="reference internal" href="generated/core/altair.FieldEqualPredicate.html#altair.FieldEqualPredicate" title="altair.FieldEqualPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldEqualPredicate</span></code></a> used to select just the
values from year 2000 as in the above chart:</p>
<div class="highlight-python" id="transform-rst-altair-source-9"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">FieldEqualPredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">equal</span><span class="o">=</span><span class="mi">2000</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-9">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "transform": [{"filter": {"equal": 2000, "field": "year"}}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-9', spec, opt).catch(console.err);
  });
</script>
</div><p>A <a class="reference internal" href="generated/core/altair.FieldOneOfPredicate.html#altair.FieldOneOfPredicate" title="altair.FieldOneOfPredicate"><code class="xref py py-class docutils literal"><span class="pre">FieldOneOfPredicate</span></code></a> is similar, but allows selection of any number
of specific values:</p>
<div class="highlight-python" id="transform-rst-altair-source-10"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">FieldOneOfPredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">oneOf</span><span class="o">=</span><span class="p">[</span><span class="mi">1900</span><span class="p">,</span> <span class="mi">1950</span><span class="p">,</span> <span class="mi">2000</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-10">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "transform": [{"filter": {"field": "year", "oneOf": [1900, 1950, 2000]}}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-10', spec, opt).catch(console.err);
  });
</script>
</div><p>Finally, a <a class="reference internal" href="generated/core/altair.FieldRangePredicate.html#altair.FieldRangePredicate" title="altair.FieldRangePredicate"><code class="xref py py-meth docutils literal"><span class="pre">FieldRangePredicate()</span></code></a> allows selecting values within a
particular continuous range:</p>
<div class="highlight-python" id="transform-rst-altair-source-11"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">FieldRangePredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">1960</span><span class="p">,</span> <span class="mi">2000</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-11">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "transform": [{"filter": {"field": "year", "range": [1960, 2000]}}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-11', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="selection-predicates">
<h3>Selection Predicates<a class="headerlink" href="#selection-predicates" title="Permalink to this headline">¶</a></h3>
<p>Selection predicates can be used to filter data based on a selection. While
these can be constructed directly using a <a class="reference internal" href="generated/core/altair.SelectionPredicate.html#altair.SelectionPredicate" title="altair.SelectionPredicate"><code class="xref py py-class docutils literal"><span class="pre">SelectionPredicate</span></code></a> class,
in Altair it is often more convenient to construct them using the
<a class="reference internal" href="generated/api/altair.selection.html#altair.selection" title="altair.selection"><code class="xref py py-func docutils literal"><span class="pre">selection()</span></code></a> function. For example, this chart uses a multi-selection
that allows the user to click or shift-click on the bars in the bottom chart
to select the data to be shown in the top chart:</p>
<div class="highlight-python" id="transform-rst-altair-source-12"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">selection</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">selection_multi</span><span class="p">(</span><span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">])</span>

<span class="n">top</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="n">selection</span>
<span class="p">)</span>

<span class="n">bottom</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">()</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">condition</span><span class="p">(</span><span class="n">selection</span><span class="p">,</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;steelblue&#39;</span><span class="p">),</span> <span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="s1">&#39;lightgray&#39;</span><span class="p">))</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span><span class="o">.</span><span class="n">add_selection</span><span class="p">(</span>
    <span class="n">selection</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">vconcat</span><span class="p">(</span>
    <span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">,</span>
    <span class="n">data</span><span class="o">=</span><span class="n">pop</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-12">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "vconcat": [{"mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "height": 200, "transform": [{"filter": {"selection": "selector049"}}], "width": 600}, {"mark": "bar", "encoding": {"color": {"condition": {"value": "steelblue", "selection": "selector049"}, "value": "lightgray"}, "x": {"type": "ordinal", "field": "year"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "height": 100, "selection": {"selector049": {"type": "multi", "fields": ["year"]}}, "width": 600}], "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-12', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="logical-operands">
<h3>Logical Operands<a class="headerlink" href="#logical-operands" title="Permalink to this headline">¶</a></h3>
<p>At times it is useful to combine several types of predicates into a single
selection. This can be accomplished using the various logical operand classes:</p>
<ul class="simple">
<li><a class="reference internal" href="generated/core/altair.LogicalOrPredicate.html#altair.LogicalOrPredicate" title="altair.LogicalOrPredicate"><code class="xref py py-class docutils literal"><span class="pre">LogicalOrPredicate</span></code></a></li>
<li><a class="reference internal" href="generated/core/altair.LogicalAndPredicate.html#altair.LogicalAndPredicate" title="altair.LogicalAndPredicate"><code class="xref py py-class docutils literal"><span class="pre">LogicalAndPredicate</span></code></a></li>
<li><a class="reference internal" href="generated/core/altair.LogicalNotPredicate.html#altair.LogicalNotPredicate" title="altair.LogicalNotPredicate"><code class="xref py py-class docutils literal"><span class="pre">LogicalNotPredicate</span></code></a></li>
</ul>
<p>These are not yet part of the Altair interface
(see <a class="reference external" href="https://github.com/altair-viz/altair/issues/695">Issue 695</a>)
but can be constructed explicitly; for example, here we plot US population
distributions for all data <em>except</em> the years 1950-1960,
by applying a <code class="docutils literal"><span class="pre">LogicalNotPredicate</span></code> schema to a <code class="docutils literal"><span class="pre">FieldRangePredicate</span></code>:</p>
<div class="highlight-python" id="transform-rst-altair-source-13"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">pop</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">population</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">pop</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;age:O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;sum(people):Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="p">{</span><span class="s1">&#39;not&#39;</span><span class="p">:</span> <span class="n">alt</span><span class="o">.</span><span class="n">FieldRangePredicate</span><span class="p">(</span><span class="n">field</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="mi">1900</span><span class="p">,</span> <span class="mi">1950</span><span class="p">])}</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-13">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/population.json"}, "mark": "line", "encoding": {"color": {"type": "ordinal", "field": "year"}, "x": {"type": "ordinal", "field": "age"}, "y": {"type": "quantitative", "aggregate": "sum", "field": "people"}}, "height": 200, "transform": [{"filter": {"not": {"field": "year", "range": [1900, 1950]}}}], "width": 600, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-13', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="id3">
<h3>Transform Options<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_filter" title="altair.Chart.transform_filter"><code class="xref py py-meth docutils literal"><span class="pre">transform_filter()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.FilterTransform.html#altair.FilterTransform" title="altair.FilterTransform"><code class="xref py py-class docutils literal"><span class="pre">FilterTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">filter</td>
<td><code class="xref py py-class docutils literal"><span class="pre">LogicalOperand&lt;Predicate&gt;</span></code></td>
<td class="vl-decsr"><p class="first">The <code class="docutils literal"><span class="pre">filter</span></code> property must be one of the predicate definitions:</p>
<ol class="last simple">
<li>an <a class="reference external" href="https://vega.github.io/vega-lite/docs/types.html#expression">expression</a> string,
where <code class="docutils literal"><span class="pre">datum</span></code> can be used to refer to the current data object</li>
<li>one of the field predicates: <a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#equal-predicate"><code class="docutils literal"><span class="pre">equal</span></code></a>,
<a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#lt-predicate"><code class="docutils literal"><span class="pre">lt</span></code></a>,
<a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#lte-predicate"><code class="docutils literal"><span class="pre">lte</span></code></a>,
<a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#gt-predicate"><code class="docutils literal"><span class="pre">gt</span></code></a>,
<a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#gte-predicate"><code class="docutils literal"><span class="pre">gte</span></code></a>,
<a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#range-predicate"><code class="docutils literal"><span class="pre">range</span></code></a>,
<a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#one-of-predicate"><code class="docutils literal"><span class="pre">oneOf</span></code></a>,
or <a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#valid-predicate"><code class="docutils literal"><span class="pre">valid</span></code></a>,</li>
<li>a <a class="reference external" href="https://vega.github.io/vega-lite/docs/filter.html#selection-predicate">selection predicate</a></li>
<li>a logical operand that combines (1), (2), or (3).</li>
</ol>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="flatten-transform">
<span id="user-guide-flatten-transform"></span><h2>Flatten Transform<a class="headerlink" href="#flatten-transform" title="Permalink to this headline">¶</a></h2>
<p>The flatten transform can be used to extract the contents of arrays from data entries.
This will not generally be useful for well-structured data within pandas dataframes,
but it can be useful for working with data from other sources.</p>
<p>As an example, consider this dataset which uses a common convention in JSON data,
a set of fields each containing a list of entries:</p>
<div class="highlight-python" id="transform-rst-altair-source-14"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">generate_data</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">()</span>
    <span class="n">std</span> <span class="o">=</span> <span class="n">rand</span><span class="o">.</span><span class="n">rand</span><span class="p">()</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">rand</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">std</span><span class="p">,</span> <span class="n">N</span><span class="p">))</span>

<span class="n">data</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">generate_data</span><span class="p">(</span><span class="mi">20</span><span class="p">)},</span>
    <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">generate_data</span><span class="p">(</span><span class="mi">30</span><span class="p">)},</span>
    <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;C&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">generate_data</span><span class="p">(</span><span class="mi">40</span><span class="p">)},</span>
    <span class="p">{</span><span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="s1">&#39;values&#39;</span><span class="p">:</span> <span class="n">generate_data</span><span class="p">(</span><span class="mi">50</span><span class="p">)},</span>
<span class="p">]</span>
</pre></div>
</div>
<p>This kind of data structure does not work well in the context of dataframe
representations, as we can see by loading this into pandas:</p>
<div class="highlight-python" id="transform-rst-altair-source-15"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_records</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>      label                                             values
    0     A  [2.00525245584, 0.396787181386, 2.56786466234,...
    1     B  [1.19062287621, -1.69271652246, -0.53126983475...
    2     C  [0.390195675627, 1.41350720659, 0.603567403162...
    3     D  [1.00352110723, 1.14142404997, 1.88396634007, ...
</pre></div>
</div>
<p>Alair’s flatten transform allows you to extract the contents of these arrays
into a column that can be referenced by an encoding:</p>
<div class="highlight-python" id="transform-rst-altair-source-16"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="o">.</span><span class="n">transform_flatten</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;values&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_tick</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;values:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;label:N&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-16">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-7da2255847635beb11936fd307dac9ec"}, "mark": "tick", "encoding": {"x": {"type": "quantitative", "field": "values"}, "y": {"type": "nominal", "field": "label"}}, "transform": [{"flatten": ["values"]}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-7da2255847635beb11936fd307dac9ec": [{"label": "A", "values": [2.005252455842496, 0.3967871813856627, 2.5678646623388275, 1.256089150184741, 2.9514506567717906, 2.527222225531605, 1.4591284949861767, 3.2982061599790526, 2.4155261835794164, 2.0559779750579663, 2.1131370161326797, 1.6546010213924336, 2.614072050380182, 1.5383345252691776, 1.9299318117536766, 1.1849446526226046, 1.9912501219482928, 1.7842081074077434, 2.174273355818932, 0.8216338025661822]}, {"label": "B", "values": [1.1906228762083413, -1.6927165224630425, -0.5312698347586192, -0.7116216632399595, 0.6200316857888714, 0.5709294410904627, -0.4467321033662996, -0.27391145767462716, -1.254051255246734, -2.1002969780432346, -0.8360629274037326, -0.44564698124334645, 0.38583487238439984, 0.364225365993753, -0.8665790912905293, -0.8007505943360111, -1.3785226511430397, -1.6661233469968009, -1.887749485291185, 0.9436584110758434, -0.9612875094377379, -0.9058695032147039, -1.5366539941494795, 0.035261606263304435, -1.816231705316691, -0.7314083124732873, -1.2599979998699076, -0.26714467206306675, -0.9621801666738584, -1.4807828322098298]}, {"label": "C", "values": [0.3901956756272385, 1.4135072065946024, 0.6035674031624774, -0.38404980732869126, -0.6911855699015029, -0.37359215824933706, -0.7517155338563645, -0.6875172870877814, -0.1578807228410085, 0.5772153327340649, 1.721361426964954, 0.138844345725191, -1.7137508555740186, 0.12874278235884798, -0.8672056648567803, -0.22980617258976452, 0.448893739511322, -0.8470312944954548, 0.34412368545474464, -0.9960579965102729, 0.9660433966704345, 0.3054670482358442, -1.249999209937088, 0.8755667027899261, -0.9119421407710063, 1.772663916818762, 1.4618738821396275, -1.4401251360569163, 0.3402135805899632, -0.0970997842957472, 0.5619374646250908, 0.4329945402636224, 0.772681079048851, 0.8582476204206989, -0.6003912168777169, 0.887588766646983, -0.27687350513267617, 0.9227911093297897, 0.17428351802783523, 1.045905261505769]}, {"label": "D", "values": [1.0035211072316703, 1.1414240499680273, 1.883966340074569, 0.26423250248465424, 0.30297187418499605, 1.4258791863570983, 0.35178161480539905, 1.9142816703932795, 0.7325397009154708, 0.565179659434326, 1.9039147037041628, 1.682115143547207, 1.8761498223455284, 1.3941192591059013, 0.5081435465385542, 1.8974591128502323, 0.8055403565015302, 1.3421879374437606, 1.4147774880710302, 0.8621866416868407, 1.247749941590691, 1.402221670429774, 1.1286082775460302, 0.38874055896865456, 1.089411049148803, 1.6048465706509238, 0.5916931778120245, 0.8648815373533479, 0.7217438954379445, 1.8669779764973786, 1.2769347343298254, 1.1441675340102975, 0.5539192806412725, 1.210235748326848, 0.6018375764809559, 0.9558544157512746, 0.6211318385541937, 1.2790094843017004, 1.2289560155621015, 0.8354717359017642, 1.1384248012619282, 0.3919185955258142, 0.19229318984136412, 1.1601747538581697, 1.0234544678492, 1.2582537234019644, 2.1346255620985195, 1.4133875758559218, 0.482276942818254, 1.4998844810297163]}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-16', spec, opt).catch(console.err);
  });
</script>
</div><p>This can be particularly useful in cleaning up data specified via a JSON URL,
without having to first load the data for manipulation in pandas.</p>
<div class="section" id="id4">
<h3>Transform Options<a class="headerlink" href="#id4" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_flatten" title="altair.Chart.transform_flatten"><code class="xref py py-meth docutils literal"><span class="pre">transform_flatten()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.FlattenTransform.html#altair.FlattenTransform" title="altair.FlattenTransform"><code class="xref py py-class docutils literal"><span class="pre">FlattenTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr"><p class="first">The output field names for extracted array values.</p>
<p class="last"><strong>Default value:</strong> The field name of the corresponding array field</p>
</td>
</tr>
<tr class="row-odd"><td class="vl-prop">flatten</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr">An array of one or more data fields containing arrays to flatten.
If multiple fields are specified, their array values should have a parallel structure, ideally with the same length.
If the lengths of parallel arrays do not match,
the longest array will be used with <code class="docutils literal"><span class="pre">null</span></code> values added for missing entries.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="fold-transform">
<span id="user-guide-fold-transform"></span><h2>Fold Transform<a class="headerlink" href="#fold-transform" title="Permalink to this headline">¶</a></h2>
<p>The fold transform is, in short, a way to convert wide-form data to long-form
data directly without any preprocessing (see <a class="reference internal" href="data.html#data-long-vs-wide"><span class="std std-ref">Long-form vs. Wide-form Data</span></a> for more
information).</p>
<p>So, for example, if your data consist of multiple columns that record parallel
data for different categories, you can use the fold transform to encode based
on those categories:</p>
<div class="highlight-python" id="transform-rst-altair-source-17"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="s1">&#39;2019-01-01&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;D&#39;</span><span class="p">,</span> <span class="n">periods</span><span class="o">=</span><span class="mi">30</span><span class="p">),</span>
    <span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span>
    <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span>
    <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(),</span>
<span class="p">})</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">transform_fold</span><span class="p">(</span>
    <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;key:N&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-17">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-323bee835559f9f913139f56468205ce"}, "mark": "line", "encoding": {"color": {"type": "nominal", "field": "key"}, "x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "value"}}, "transform": [{"fold": ["A", "B", "C"]}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-323bee835559f9f913139f56468205ce": [{"date": "2019-01-01T00:00:00", "A": 1.764052345967664, "B": 0.1549474256969163, "C": -0.672460447775951}, {"date": "2019-01-02T00:00:00", "A": 2.1642095543348874, "B": 0.5331099452990898, "C": -1.0320136093164924}, {"date": "2019-01-03T00:00:00", "A": 3.1429475384406267, "B": -0.3546758023310229, "C": -1.8451598913609466}, {"date": "2019-01-04T00:00:00", "A": 5.3838407376420845, "B": -2.3354722705549498, "C": -3.5714424936926235}, {"date": "2019-01-05T00:00:00", "A": 7.251398727792052, "B": -2.6833844198811025, "C": -3.3940163514388706}, {"date": "2019-01-06T00:00:00", "A": 6.274120847915642, "B": -2.5270354507771224, "C": -3.7957972876471326}, {"date": "2019-01-07T00:00:00", "A": 7.224209265441231, "B": -1.2967447700494017, "C": -5.4259956346131775}, {"date": "2019-01-08T00:00:00", "A": 7.072852057143533, "B": -0.09436492126499041, "C": -4.963213379087403}, {"date": "2019-01-09T00:00:00", "A": 6.969633205349975, "B": -0.4816917386729427, "C": -5.8705117434706455}, {"date": "2019-01-10T00:00:00", "A": 7.380231707288347, "B": -0.7839944892482782, "C": -5.818566347674507}, {"date": "2019-01-11T00:00:00", "A": 7.524275278449225, "B": -1.8325474543153708, "C": -5.08947578549697}, {"date": "2019-01-12T00:00:00", "A": 8.9785487854122, "B": -3.252565391494346, "C": -4.960492874739559}, {"date": "2019-01-13T00:00:00", "A": 9.739586510559192, "B": -4.958835582119359, "C": -3.821092190196259}, {"date": "2019-01-14T00:00:00", "A": 9.86126152705202, "B": -3.008060186887569, "C": -5.055918010549911}, {"date": "2019-01-15T00:00:00", "A": 10.305124759797446, "B": -3.5177123686392227, "C": -4.653576369372362}, {"date": "2019-01-16T00:00:00", "A": 10.638799087171712, "B": -3.955786670250409, "C": -5.338386460312675}, {"date": "2019-01-17T00:00:00", "A": 12.132878160329318, "B": -5.208582030300335, "C": -6.2091836094945565}, {"date": "2019-01-18T00:00:00", "A": 11.927719896563516, "B": -4.4310916744684254, "C": -6.7880332742589715}, {"date": "2019-01-19T00:00:00", "A": 12.240787598214418, "B": -6.044989522026377, "C": -7.099585806386344}, {"date": "2019-01-20T00:00:00", "A": 11.386691858912693, "B": -6.257729802240346, "C": -7.043420464156599}, {"date": "2019-01-21T00:00:00", "A": 8.833702043078613, "B": -7.153196363434021, "C": -8.208570304939956}, {"date": "2019-01-22T00:00:00", "A": 9.487320638518973, "B": -6.766293865574759, "C": -7.307743817985768}, {"date": "2019-01-23T00:00:00", "A": 10.35175683737848, "B": -7.277099003143632, "C": -6.842081378255308}, {"date": "2019-01-24T00:00:00", "A": 9.609591816972037, "B": -8.457731187266043, "C": -8.378325064532532}, {"date": "2019-01-25T00:00:00", "A": 11.879346440959644, "B": -8.4859134156047, "C": -6.890072870736933}, {"date": "2019-01-26T00:00:00", "A": 10.424980766360878, "B": -8.057581545074282, "C": -4.99418369470635}, {"date": "2019-01-27T00:00:00", "A": 10.470739283662324, "B": -7.9910643226911136, "C": -3.815404123546699}, {"date": "2019-01-28T00:00:00", "A": 10.28355543363649, "B": -7.688592424951332, "C": -3.99532895935905}, {"date": "2019-01-29T00:00:00", "A": 11.816334647994948, "B": -8.322914518632295, "C": -5.066081580869593}, {"date": "2019-01-30T00:00:00", "A": 13.285693417895233, "B": -8.685655684619434, "C": -4.011629853938456}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-17', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice here that the fold transform essentially stacks all the values
from the specified columns into a single new field named <code class="docutils literal"><span class="pre">&quot;value&quot;</span></code>,
with the associated names in a field named <code class="docutils literal"><span class="pre">&quot;key&quot;</span></code>.</p>
<p>For an example of the fold transform in action, see <a class="reference internal" href="../gallery/parallel_coordinates.html#gallery-parallel-coordinates"><span class="std std-ref">Parallel Coordinates Example</span></a>.</p>
<div class="section" id="id5">
<h3>Transform Options<a class="headerlink" href="#id5" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_fold" title="altair.Chart.transform_fold"><code class="xref py py-meth docutils literal"><span class="pre">transform_fold()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.FoldTransform.html#altair.FoldTransform" title="altair.FoldTransform"><code class="xref py py-class docutils literal"><span class="pre">FoldTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td>array(any)</td>
<td class="vl-decsr">The output field names for the key and value properties produced by the fold transform.
<strong>Default value:</strong> <code class="docutils literal"><span class="pre">[&quot;key&quot;,</span> <span class="pre">&quot;value&quot;]</span></code></td>
</tr>
<tr class="row-odd"><td class="vl-prop">fold</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr">An array of data fields indicating the properties to fold.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="impute-transform">
<span id="user-guide-impute-transform"></span><h2>Impute Transform<a class="headerlink" href="#impute-transform" title="Permalink to this headline">¶</a></h2>
<p>The impute transform allows you to fill-in missing entries in a dataset.
As an example, consider the following data, which includes missing values
that we filter-out of the long-form representation (see <a class="reference internal" href="data.html#data-long-vs-wide"><span class="std std-ref">Long-form vs. Wide-form Data</span></a>
for more on this):</p>
<div class="highlight-python" id="transform-rst-altair-source-18"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">),</span>
    <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
    <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>
<span class="p">})</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="s1">&#39;t&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">data</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>       t variable  value
    0  0        x    2.0
    2  2        x    3.0
    3  3        x    1.0
    4  4        x    3.0
    5  0        y    5.0
    6  1        y    7.0
    7  2        y    5.0
    9  4        y    4.0
</pre></div>
</div>
<p>Notice the result: the <code class="docutils literal"><span class="pre">x</span></code> series has no entry at <code class="docutils literal"><span class="pre">t=1</span></code>, and the <code class="docutils literal"><span class="pre">y</span></code>
series has a missing entry at <code class="docutils literal"><span class="pre">t=3</span></code>. If we use Altair to visualize this
data directly, the line skips the missing entries:</p>
<div class="highlight-python" id="transform-rst-altair-source-19"><div class="highlight"><pre><span></span><span class="n">raw</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;t:Q&#39;</span><span class="p">),</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable:N&#39;</span>
<span class="p">)</span>
<span class="n">raw</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-19">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-7be20e7420cc57bc379470ef15f02789"}, "mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-7be20e7420cc57bc379470ef15f02789": [{"t": 0, "variable": "x", "value": 2.0}, {"t": 2, "variable": "x", "value": 3.0}, {"t": 3, "variable": "x", "value": 1.0}, {"t": 4, "variable": "x", "value": 3.0}, {"t": 0, "variable": "y", "value": 5.0}, {"t": 1, "variable": "y", "value": 7.0}, {"t": 2, "variable": "y", "value": 5.0}, {"t": 4, "variable": "y", "value": 4.0}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-19', spec, opt).catch(console.err);
  });
</script>
</div><p>This is not always desireable, because (particularly for a line plot with
no points) it can imply the esistence of data that is not there.</p>
<div class="section" id="impute-via-encodings">
<h3>Impute via Encodings<a class="headerlink" href="#impute-via-encodings" title="Permalink to this headline">¶</a></h3>
<p>To address this, you can use an impute argument to the encoding channel.
For example, we can impute using a constant value (we’ll show the raw chart
lightly in the background for reference):</p>
<div class="highlight-python" id="transform-rst-altair-source-20"><div class="highlight"><pre><span></span><span class="n">background</span> <span class="o">=</span> <span class="n">raw</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">opacity</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="mf">0.2</span><span class="p">))</span>
<span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;value:Q&#39;</span><span class="p">,</span> <span class="n">impute</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">ImputeParams</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable:N&#39;</span>
<span class="p">)</span>
<span class="n">background</span> <span class="o">+</span> <span class="n">chart</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-20">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "layer": [{"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "opacity": {"value": 0.2}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}}, {"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value", "impute": {"value": 0}}}}], "data": {"name": "data-7be20e7420cc57bc379470ef15f02789"}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-7be20e7420cc57bc379470ef15f02789": [{"t": 0, "variable": "x", "value": 2.0}, {"t": 2, "variable": "x", "value": 3.0}, {"t": 3, "variable": "x", "value": 1.0}, {"t": 4, "variable": "x", "value": 3.0}, {"t": 0, "variable": "y", "value": 5.0}, {"t": 1, "variable": "y", "value": 7.0}, {"t": 2, "variable": "y", "value": 5.0}, {"t": 4, "variable": "y", "value": 4.0}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-20', spec, opt).catch(console.err);
  });
</script>
</div><p>Or we can impute using any supported aggregate:</p>
<div class="highlight-python" id="transform-rst-altair-source-21"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;value:Q&#39;</span><span class="p">,</span> <span class="n">impute</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">ImputeParams</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable:N&#39;</span>
<span class="p">)</span>
<span class="n">background</span> <span class="o">+</span> <span class="n">chart</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-21">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "layer": [{"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "opacity": {"value": 0.2}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}}, {"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value", "impute": {"method": "mean"}}}}], "data": {"name": "data-7be20e7420cc57bc379470ef15f02789"}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-7be20e7420cc57bc379470ef15f02789": [{"t": 0, "variable": "x", "value": 2.0}, {"t": 2, "variable": "x", "value": 3.0}, {"t": 3, "variable": "x", "value": 1.0}, {"t": 4, "variable": "x", "value": 3.0}, {"t": 0, "variable": "y", "value": 5.0}, {"t": 1, "variable": "y", "value": 7.0}, {"t": 2, "variable": "y", "value": 5.0}, {"t": 4, "variable": "y", "value": 4.0}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-21', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="impute-via-transform">
<h3>Impute via Transform<a class="headerlink" href="#impute-via-transform" title="Permalink to this headline">¶</a></h3>
<p>Similar to the <a class="reference internal" href="#user-guide-bin-transform"><span class="std std-ref">Bin transforms</span></a> and <a class="reference internal" href="#user-guide-aggregate-transform"><span class="std std-ref">Aggregate Transforms</span></a>,
it is also possible to specify the impute transform outside the encoding as a
transform. For example, here is the equivalent of the above two charts:</p>
<div class="highlight-python" id="transform-rst-altair-source-22"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">transform_impute</span><span class="p">(</span>
    <span class="n">impute</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
    <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable:N&#39;</span>
<span class="p">)</span>
<span class="n">background</span> <span class="o">+</span> <span class="n">chart</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-22">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "layer": [{"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "opacity": {"value": 0.2}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}}, {"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}, "transform": [{"impute": "value", "key": "t", "groupby": ["variable"], "value": 0}]}], "data": {"name": "data-7be20e7420cc57bc379470ef15f02789"}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-7be20e7420cc57bc379470ef15f02789": [{"t": 0, "variable": "x", "value": 2.0}, {"t": 2, "variable": "x", "value": 3.0}, {"t": 3, "variable": "x", "value": 1.0}, {"t": 4, "variable": "x", "value": 3.0}, {"t": 0, "variable": "y", "value": 5.0}, {"t": 1, "variable": "y", "value": 7.0}, {"t": 2, "variable": "y", "value": 5.0}, {"t": 4, "variable": "y", "value": 4.0}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-22', spec, opt).catch(console.err);
  });
</script>
</div><div class="highlight-python" id="transform-rst-altair-source-23"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">transform_impute</span><span class="p">(</span>
    <span class="n">impute</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable:N&#39;</span>
<span class="p">)</span>
<span class="n">background</span> <span class="o">+</span> <span class="n">chart</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-23">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "layer": [{"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "opacity": {"value": 0.2}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}}, {"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}, "transform": [{"impute": "value", "key": "t", "groupby": ["variable"], "method": "mean"}]}], "data": {"name": "data-7be20e7420cc57bc379470ef15f02789"}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-7be20e7420cc57bc379470ef15f02789": [{"t": 0, "variable": "x", "value": 2.0}, {"t": 2, "variable": "x", "value": 3.0}, {"t": 3, "variable": "x", "value": 1.0}, {"t": 4, "variable": "x", "value": 3.0}, {"t": 0, "variable": "y", "value": 5.0}, {"t": 1, "variable": "y", "value": 7.0}, {"t": 2, "variable": "y", "value": 5.0}, {"t": 4, "variable": "y", "value": 4.0}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-23', spec, opt).catch(console.err);
  });
</script>
</div><p>If you would like to use more localized imputed values, you can specify a
<code class="docutils literal"><span class="pre">frame</span></code> parameter similar to the <a class="reference internal" href="#user-guide-window-transform"><span class="std std-ref">Window Transform</span></a> that
will control which values are used for the imputation. For example, here
we impute missing values using the mean of the neighboring points on either
side:</p>
<div class="highlight-python" id="transform-rst-altair-source-24"><div class="highlight"><pre><span></span><span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">transform_impute</span><span class="p">(</span>
    <span class="n">impute</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">,</span>
    <span class="n">key</span><span class="o">=</span><span class="s1">&#39;t&#39;</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">(</span><span class="n">point</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;t:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;variable:N&#39;</span>
<span class="p">)</span>
<span class="n">background</span> <span class="o">+</span> <span class="n">chart</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-24">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "layer": [{"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "opacity": {"value": 0.2}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}}, {"mark": {"type": "line", "point": true}, "encoding": {"color": {"type": "nominal", "field": "variable"}, "x": {"type": "quantitative", "field": "t"}, "y": {"type": "quantitative", "field": "value"}}, "transform": [{"impute": "value", "key": "t", "frame": [-1, 1], "groupby": ["variable"], "method": "mean"}]}], "data": {"name": "data-7be20e7420cc57bc379470ef15f02789"}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-7be20e7420cc57bc379470ef15f02789": [{"t": 0, "variable": "x", "value": 2.0}, {"t": 2, "variable": "x", "value": 3.0}, {"t": 3, "variable": "x", "value": 1.0}, {"t": 4, "variable": "x", "value": 3.0}, {"t": 0, "variable": "y", "value": 5.0}, {"t": 1, "variable": "y", "value": 7.0}, {"t": 2, "variable": "y", "value": 5.0}, {"t": 4, "variable": "y", "value": 4.0}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-24', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="id6">
<h3>Transform Options<a class="headerlink" href="#id6" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_impute" title="altair.Chart.transform_impute"><code class="xref py py-meth docutils literal"><span class="pre">transform_impute()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.ImputeTransform.html#altair.ImputeTransform" title="altair.ImputeTransform"><code class="xref py py-class docutils literal"><span class="pre">ImputeTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">frame</td>
<td>array([null, number])</td>
<td class="vl-decsr"><p class="first">A frame specification as a two-element array used to control the window over which the specified method is applied. The array entries should either be a number indicating the offset from the current data object, or null to indicate unbounded rows preceding or following the current data object.  For example, the value <code class="docutils literal"><span class="pre">[-5,</span> <span class="pre">5]</span></code> indicates that the window should include five objects preceding and five objects following the current object.</p>
<p class="last"><strong>Default value:</strong>:  <code class="docutils literal"><span class="pre">[null,</span> <span class="pre">null]</span></code> indicating that the window includes all objects.</p>
</td>
</tr>
<tr class="row-odd"><td class="vl-prop">groupby</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr">An optional array of fields by which to group the values.
Imputation will then be performed on a per-group basis.</td>
</tr>
<tr class="row-even"><td class="vl-prop">impute</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The data field for which the missing values should be imputed.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">key</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">A key field that uniquely identifies data objects within a group.
Missing key values (those occurring in the data but not in the current group) will be imputed.</td>
</tr>
<tr class="row-even"><td class="vl-prop">keyvals</td>
<td>anyOf(array(any), <a class="reference internal" href="generated/core/altair.ImputeSequence.html#altair.ImputeSequence" title="altair.ImputeSequence"><code class="xref py py-class docutils literal"><span class="pre">ImputeSequence</span></code></a>)</td>
<td class="vl-decsr"><p class="first">Defines the key values that should be considered for imputation.
An array of key values or an object defining a <a class="reference external" href="https://vega.github.io/vega-lite/docs/impute.html#sequence-def">number sequence</a>.</p>
<p>If provided, this will be used in addition to the key values observed within the input data.  If not provided, the values will be derived from all unique values of the <code class="docutils literal"><span class="pre">key</span></code> field. For <code class="docutils literal"><span class="pre">impute</span></code> in <code class="docutils literal"><span class="pre">encoding</span></code>, the key field is the x-field if the y-field is imputed, or vice versa.</p>
<p class="last">If there is no impute grouping, this property <em>must</em> be specified.</p>
</td>
</tr>
<tr class="row-odd"><td class="vl-prop">method</td>
<td><a class="reference internal" href="generated/core/altair.ImputeMethod.html#altair.ImputeMethod" title="altair.ImputeMethod"><code class="xref py py-class docutils literal"><span class="pre">ImputeMethod</span></code></a></td>
<td class="vl-decsr"><p class="first">The imputation method to use for the field value of imputed data objects.
One of <code class="docutils literal"><span class="pre">value</span></code>, <code class="docutils literal"><span class="pre">mean</span></code>, <code class="docutils literal"><span class="pre">median</span></code>, <code class="docutils literal"><span class="pre">max</span></code> or <code class="docutils literal"><span class="pre">min</span></code>.</p>
<p class="last"><strong>Default value:</strong>  <code class="docutils literal"><span class="pre">&quot;value&quot;</span></code></p>
</td>
</tr>
<tr class="row-even"><td class="vl-prop">value</td>
<td>any</td>
<td class="vl-decsr">The field value to use when the imputation <code class="docutils literal"><span class="pre">method</span></code> is <code class="docutils literal"><span class="pre">&quot;value&quot;</span></code>.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="join-aggregate-transform">
<span id="user-guide-joinaggregate-transform"></span><h2>Join Aggregate Transform<a class="headerlink" href="#join-aggregate-transform" title="Permalink to this headline">¶</a></h2>
<p>The Join Aggregate transform acts in almost every way the same as an Aggregate
transform, but the resulting aggregate is joined to the original dataset.
To make this more clear, consider the following dataset:</p>
<div class="highlight-python" id="transform-rst-altair-source-25"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>

<span class="n">rand</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">RandomState</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
    <span class="s1">&#39;label&#39;</span><span class="p">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">choice</span><span class="p">([</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">],</span> <span class="mi">10</span><span class="p">),</span>
    <span class="s1">&#39;value&#39;</span><span class="p">:</span> <span class="n">rand</span><span class="o">.</span><span class="n">randn</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span>
<span class="p">})</span>
<span class="n">df</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>      label     value
    0     A -0.173070
    1     B -1.761652
    2     A -0.087673
    3     B  1.366879
    4     B  1.125314
    5     C -0.358996
    6     A  1.220608
    7     C -1.339496
    8     A  0.428373
    9     A -0.123463
</pre></div>
</div>
<p>Here is a pandas operation that is equivalent to Altair’s Aggregate transform,
using the mean as an example:</p>
<div class="highlight-python" id="transform-rst-altair-source-26"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;label&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">mean</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>      label     value
    0     A  0.252955
    1     B  0.243514
    2     C -0.849246
</pre></div>
</div>
<p>And here is an output that is equivalent to Altair’s Join Aggregate:</p>
<div class="highlight-python" id="transform-rst-altair-source-27"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mean</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;label&#39;</span><span class="p">,</span> <span class="n">suffixes</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="s1">&#39;_mean&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-none"><div class="highlight"><pre><span></span>      label     value  value_mean
    0     A -0.173070    0.252955
    1     A -0.087673    0.252955
    2     A  1.220608    0.252955
    3     A  0.428373    0.252955
    4     A -0.123463    0.252955
    5     B -1.761652    0.243514
    6     B  1.366879    0.243514
    7     B  1.125314    0.243514
    8     C -0.358996   -0.849246
    9     C -1.339496   -0.849246
</pre></div>
</div>
<p>Notice that the join aggregate joins the aggregated value with the original
dataframe, such that the aggregated values can be used in tandem with the
original values if desired.</p>
<p>Here is an example of how the join aggregate might be used: we compare the
IMDB and Rotten Tomatoes movie ratings, normalized by their mean and
standard deviation, which requires calculations on the joined data:</p>
<div class="highlight-python" id="transform-rst-altair-source-28"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">transform_filter</span><span class="p">(</span>
    <span class="s1">&#39;datum.IMDB_Rating != null  &amp;&amp; datum.Rotten_Tomatoes_Rating != null&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_joinaggregate</span><span class="p">(</span>
    <span class="n">IMDB_mean</span><span class="o">=</span><span class="s1">&#39;mean(IMDB_Rating)&#39;</span><span class="p">,</span>
    <span class="n">IMDB_std</span><span class="o">=</span><span class="s1">&#39;stdev(IMDB_Rating)&#39;</span><span class="p">,</span>
    <span class="n">RT_mean</span><span class="o">=</span><span class="s1">&#39;mean(Rotten_Tomatoes_Rating)&#39;</span><span class="p">,</span>
    <span class="n">RT_std</span><span class="o">=</span><span class="s1">&#39;stdev(Rotten_Tomatoes_Rating)&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">IMDB_Deviation</span><span class="o">=</span><span class="s2">&quot;(datum.IMDB_Rating - datum.IMDB_mean) / datum.IMDB_std&quot;</span><span class="p">,</span>
    <span class="n">Rotten_Tomatoes_Deviation</span><span class="o">=</span><span class="s2">&quot;(datum.Rotten_Tomatoes_Rating - datum.RT_mean) / datum.RT_std&quot;</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;IMDB_Deviation:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Rotten_Tomatoes_Deviation:Q&quot;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-28">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/movies.json"}, "mark": "point", "encoding": {"x": {"type": "quantitative", "field": "IMDB_Deviation"}, "y": {"type": "quantitative", "field": "Rotten_Tomatoes_Deviation"}}, "transform": [{"filter": "datum.IMDB_Rating != null  && datum.Rotten_Tomatoes_Rating != null"}, {"joinaggregate": [{"op": "mean", "field": "IMDB_Rating", "as": "IMDB_mean"}, {"op": "stdev", "field": "IMDB_Rating", "as": "IMDB_std"}, {"op": "mean", "field": "Rotten_Tomatoes_Rating", "as": "RT_mean"}, {"op": "stdev", "field": "Rotten_Tomatoes_Rating", "as": "RT_std"}]}, {"calculate": "(datum.IMDB_Rating - datum.IMDB_mean) / datum.IMDB_std", "as": "IMDB_Deviation"}, {"calculate": "(datum.Rotten_Tomatoes_Rating - datum.RT_mean) / datum.RT_std", "as": "Rotten_Tomatoes_Deviation"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-28', spec, opt).catch(console.err);
  });
</script>
</div><div class="section" id="id7">
<h3>Transform Options<a class="headerlink" href="#id7" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_joinaggregate" title="altair.Chart.transform_joinaggregate"><code class="xref py py-meth docutils literal"><span class="pre">transform_joinaggregate()</span></code></a> method is built on the
<a class="reference internal" href="generated/core/altair.JoinAggregateTransform.html#altair.JoinAggregateTransform" title="altair.JoinAggregateTransform"><code class="xref py py-class docutils literal"><span class="pre">JoinAggregateTransform</span></code></a> class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">groupby</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr">The data fields for partitioning the data objects into separate groups. If unspecified, all data points will be in a single group.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">joinaggregate</td>
<td>array(<a class="reference internal" href="generated/core/altair.JoinAggregateFieldDef.html#altair.JoinAggregateFieldDef" title="altair.JoinAggregateFieldDef"><code class="xref py py-class docutils literal"><span class="pre">JoinAggregateFieldDef</span></code></a>)</td>
<td class="vl-decsr">The definition of the fields in the join aggregate, and what calculations to use.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="lookup-transform">
<span id="user-guide-lookup-transform"></span><h2>Lookup Transform<a class="headerlink" href="#lookup-transform" title="Permalink to this headline">¶</a></h2>
<p>The Lookup transform extends a primary data source by looking up values from
another data source; it is similar to a one-sided join. A lookup can be added
at the top level of a chart using the <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_lookup" title="altair.Chart.transform_lookup"><code class="xref py py-meth docutils literal"><span class="pre">Chart.transform_lookup()</span></code></a> method.</p>
<p>By way of example, imagine you have two sources of data that you would like
to combine and plot: one is a list of names of people along with their height
and weight, and the other is some information about which groups they belong
to. This example data is available in <code class="docutils literal"><span class="pre">vega_datasets</span></code>:</p>
<div class="highlight-python" id="transform-rst-altair-source-29"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>
<span class="n">people</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lookup_people</span><span class="p">()</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">lookup_groups</span><span class="p">()</span>
</pre></div>
</div>
<p>We know how to visualize each of these datasets separately; for example:</p>
<div class="highlight-python" id="transform-rst-altair-source-30"><div class="highlight"><pre><span></span><span class="n">top</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">people</span><span class="p">)</span><span class="o">.</span><span class="n">mark_square</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;age:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;height:Q&#39;</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Scale</span><span class="p">(</span><span class="n">zero</span><span class="o">=</span><span class="bp">False</span><span class="p">)),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;name:N&#39;</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="s1">&#39;name:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span>

<span class="n">bottom</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rect</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;person:N&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;group:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">100</span>
<span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">vconcat</span><span class="p">(</span><span class="n">top</span><span class="p">,</span> <span class="n">bottom</span><span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-30">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "vconcat": [{"data": {"name": "data-59fcb3ae476d760b9995707aff1a6876"}, "mark": {"type": "square", "size": 200}, "encoding": {"color": {"type": "nominal", "field": "name"}, "tooltip": {"type": "nominal", "field": "name"}, "x": {"type": "quantitative", "field": "age", "scale": {"zero": false}}, "y": {"type": "quantitative", "field": "height", "scale": {"zero": false}}}, "height": 200, "width": 400}, {"data": {"name": "data-733965e67b2edf1f86cd8d2aa1bfc4e1"}, "mark": "rect", "encoding": {"x": {"type": "nominal", "field": "person"}, "y": {"type": "ordinal", "field": "group"}}, "height": 100, "width": 400}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-59fcb3ae476d760b9995707aff1a6876": [{"name": "Alan", "age": 25, "height": 180}, {"name": "George", "age": 32, "height": 174}, {"name": "Fred", "age": 39, "height": 182}, {"name": "Steve", "age": 42, "height": 161}, {"name": "Nick", "age": 23, "height": 180}, {"name": "Will", "age": 21, "height": 168}, {"name": "Cole", "age": 51, "height": 160}, {"name": "Rick", "age": 63, "height": 181}, {"name": "Tom", "age": 54, "height": 179}], "data-733965e67b2edf1f86cd8d2aa1bfc4e1": [{"group": 1, "person": "Alan"}, {"group": 1, "person": "George"}, {"group": 1, "person": "Fred"}, {"group": 2, "person": "Steve"}, {"group": 2, "person": "Nick"}, {"group": 2, "person": "Will"}, {"group": 3, "person": "Cole"}, {"group": 3, "person": "Rick"}, {"group": 3, "person": "Tom"}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-30', spec, opt).catch(console.err);
  });
</script>
</div><p>If we would like to plot features that reference both datasets (for example, the
average age within each group), we need to combine the two datasets.
This can be done either as a data preprocessing step, using tools available
in Pandas, or as part of the visualization using a <a class="reference internal" href="generated/core/altair.LookupTransform.html#altair.LookupTransform" title="altair.LookupTransform"><code class="xref py py-class docutils literal"><span class="pre">LookupTransform</span></code></a>
in Altair.</p>
<div class="section" id="combining-datasets-with-pandas-merge">
<h3>Combining Datasets with pandas.merge<a class="headerlink" href="#combining-datasets-with-pandas-merge" title="Permalink to this headline">¶</a></h3>
<p>Pandas provides a wide range of tools for merging and joining datasets; see
<a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/merging.html">Merge, Join, and Concatenate</a>
for some detailed examples.
For the above data, we can merge the data and create a combined chart as follows:</p>
<div class="highlight-python" id="transform-rst-altair-source-31"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">groups</span><span class="p">,</span> <span class="n">people</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span>
                  <span class="n">left_on</span><span class="o">=</span><span class="s1">&#39;person&#39;</span><span class="p">,</span> <span class="n">right_on</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">)</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">merged</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean(age):Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;group:O&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-31">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-012c730680c958500c1ff1e1531590f9"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "aggregate": "mean", "field": "age"}, "y": {"type": "ordinal", "field": "group"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-012c730680c958500c1ff1e1531590f9": [{"group": 1, "person": "Alan", "name": "Alan", "age": 25, "height": 180}, {"group": 1, "person": "George", "name": "George", "age": 32, "height": 174}, {"group": 1, "person": "Fred", "name": "Fred", "age": 39, "height": 182}, {"group": 2, "person": "Steve", "name": "Steve", "age": 42, "height": 161}, {"group": 2, "person": "Nick", "name": "Nick", "age": 23, "height": 180}, {"group": 2, "person": "Will", "name": "Will", "age": 21, "height": 168}, {"group": 3, "person": "Cole", "name": "Cole", "age": 51, "height": 160}, {"group": 3, "person": "Rick", "name": "Rick", "age": 63, "height": 181}, {"group": 3, "person": "Tom", "name": "Tom", "age": 54, "height": 179}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-31', spec, opt).catch(console.err);
  });
</script>
</div><p>We specify a left join, meaning that for each entry of the “person” column in
the groups, we seek the “name” column in people and add the entry to the data.
From this, we can easily create a bar chart representing the mean age in each group.</p>
</div>
<div class="section" id="combining-datasets-with-a-lookup-transform">
<h3>Combining Datasets with a Lookup Transform<a class="headerlink" href="#combining-datasets-with-a-lookup-transform" title="Permalink to this headline">¶</a></h3>
<p>For some data sources (e.g. data available at a URL, or data that is streaming),
it is desirable to have a means of joining data without having to download
it for pre-processing in Pandas.
This is where Altair’s <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_lookup" title="altair.Chart.transform_lookup"><code class="xref py py-meth docutils literal"><span class="pre">transform_lookup()</span></code></a> comes in.
To reproduce the above combined plot by combining datasets within the
chart specification itself, we can do the following:</p>
<div class="highlight-python" id="transform-rst-altair-source-32"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;mean(age):Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;group:O&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_lookup</span><span class="p">(</span>
    <span class="n">lookup</span><span class="o">=</span><span class="s1">&#39;person&#39;</span><span class="p">,</span>
    <span class="n">from_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">LookupData</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">people</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span>
                         <span class="n">fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;age&#39;</span><span class="p">,</span> <span class="s1">&#39;height&#39;</span><span class="p">])</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-32">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-733965e67b2edf1f86cd8d2aa1bfc4e1"}, "mark": "bar", "encoding": {"x": {"type": "quantitative", "aggregate": "mean", "field": "age"}, "y": {"type": "ordinal", "field": "group"}}, "transform": [{"lookup": "person", "from": {"data": {"name": "data-59fcb3ae476d760b9995707aff1a6876"}, "key": "name", "fields": ["age", "height"]}}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-733965e67b2edf1f86cd8d2aa1bfc4e1": [{"group": 1, "person": "Alan"}, {"group": 1, "person": "George"}, {"group": 1, "person": "Fred"}, {"group": 2, "person": "Steve"}, {"group": 2, "person": "Nick"}, {"group": 2, "person": "Will"}, {"group": 3, "person": "Cole"}, {"group": 3, "person": "Rick"}, {"group": 3, "person": "Tom"}], "data-59fcb3ae476d760b9995707aff1a6876": [{"name": "Alan", "age": 25, "height": 180}, {"name": "George", "age": 32, "height": 174}, {"name": "Fred", "age": 39, "height": 182}, {"name": "Steve", "age": 42, "height": 161}, {"name": "Nick", "age": 23, "height": 180}, {"name": "Will", "age": 21, "height": 168}, {"name": "Cole", "age": 51, "height": 160}, {"name": "Rick", "age": 63, "height": 181}, {"name": "Tom", "age": 54, "height": 179}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-32', spec, opt).catch(console.err);
  });
</script>
</div><p>Here <code class="docutils literal"><span class="pre">lookup</span></code> names the field in the groups dataset on which we will match,
and the <code class="docutils literal"><span class="pre">from_</span></code> argument specifies a <a class="reference internal" href="generated/core/altair.LookupData.html#altair.LookupData" title="altair.LookupData"><code class="xref py py-class docutils literal"><span class="pre">LookupData</span></code></a> structure where
we supply the second dataset, the lookup key, and the fields we would like to
extract.</p>
</div>
<div class="section" id="example-lookup-transforms-for-geographical-visualization">
<h3>Example: Lookup Transforms for Geographical Visualization<a class="headerlink" href="#example-lookup-transforms-for-geographical-visualization" title="Permalink to this headline">¶</a></h3>
<p>Lookup transforms are often particularly important for geographic visualization,
where it is common to combine tabular datasets with datasets that specify
geographic boundaries to be visualized; for example, here is a visualization
of unemployment rates per county in the US:</p>
<div class="highlight-python" id="transform-rst-altair-source-33"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">counties</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">topo_feature</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">us_10m</span><span class="o">.</span><span class="n">url</span><span class="p">,</span> <span class="s1">&#39;counties&#39;</span><span class="p">)</span>
<span class="n">unemp_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">unemployment</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">counties</span><span class="p">)</span><span class="o">.</span><span class="n">mark_geoshape</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;rate:Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_lookup</span><span class="p">(</span>
    <span class="n">lookup</span><span class="o">=</span><span class="s1">&#39;id&#39;</span><span class="p">,</span>
    <span class="n">from_</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">LookupData</span><span class="p">(</span><span class="n">unemp_data</span><span class="p">,</span> <span class="s1">&#39;id&#39;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;rate&#39;</span><span class="p">])</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">projection</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;albersUsa&#39;</span><span class="p">},</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-33">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/us-10m.json", "format": {"feature": "counties", "type": "topojson"}}, "mark": "geoshape", "encoding": {"color": {"type": "quantitative", "field": "rate"}}, "height": 300, "projection": {"type": "albersUsa"}, "transform": [{"lookup": "id", "from": {"data": {"url": "https://vega.github.io/vega-datasets/data/unemployment.tsv"}, "key": "id", "fields": ["rate"]}}], "width": 500, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-33', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="id8">
<h3>Transform Options<a class="headerlink" href="#id8" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_lookup" title="altair.Chart.transform_lookup"><code class="xref py py-meth docutils literal"><span class="pre">transform_lookup()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.LookupTransform.html#altair.LookupTransform" title="altair.LookupTransform"><code class="xref py py-class docutils literal"><span class="pre">LookupTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td>anyOf(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>, array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>))</td>
<td class="vl-decsr">The field or fields for storing the computed formula value.
If <code class="docutils literal"><span class="pre">from.fields</span></code> is specified, the transform will use the same names for <code class="docutils literal"><span class="pre">as</span></code>.
If <code class="docutils literal"><span class="pre">from.fields</span></code> is not specified, <code class="docutils literal"><span class="pre">as</span></code> has to be a string and we put the whole object into the data under the specified name.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">default</td>
<td><code class="docutils literal"><span class="pre">string</span></code></td>
<td class="vl-decsr"><p class="first">The default value to use if lookup fails.</p>
<p class="last"><strong>Default value:</strong> <code class="docutils literal"><span class="pre">null</span></code></p>
</td>
</tr>
<tr class="row-even"><td class="vl-prop">from</td>
<td><a class="reference internal" href="generated/core/altair.LookupData.html#altair.LookupData" title="altair.LookupData"><code class="xref py py-class docutils literal"><span class="pre">LookupData</span></code></a></td>
<td class="vl-decsr">Secondary data reference.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">lookup</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">Key in primary data source.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="sample-transform">
<span id="user-guide-sample-transform"></span><h2>Sample Transform<a class="headerlink" href="#sample-transform" title="Permalink to this headline">¶</a></h2>
<p>The sample transform is one of the simpler of all Altair’s data transforms;
it takes a single parameter <code class="docutils literal"><span class="pre">sample</span></code> which specified a number of rows to
randomly choose from the dataset. The resulting chart will be created using
only this random subset of the data.</p>
<p>For example, here we chart the full cars dataset alongside a sample of 100
rows:</p>
<div class="highlight-python" id="transform-rst-altair-source-34"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">cars</span><span class="o">.</span><span class="n">url</span>

<span class="n">chart</span> <span class="o">=</span> <span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">mark_point</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;Horsepower:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;Miles_per_Gallon:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;Origin:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">width</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span>
    <span class="n">height</span><span class="o">=</span><span class="mi">200</span>
<span class="p">)</span>

<span class="n">chart</span> <span class="o">|</span> <span class="n">chart</span><span class="o">.</span><span class="n">transform_sample</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-34">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "hconcat": [{"mark": "point", "encoding": {"color": {"type": "nominal", "field": "Origin"}, "x": {"type": "quantitative", "field": "Horsepower"}, "y": {"type": "quantitative", "field": "Miles_per_Gallon"}}, "height": 200, "width": 200}, {"mark": "point", "encoding": {"color": {"type": "nominal", "field": "Origin"}, "x": {"type": "quantitative", "field": "Horsepower"}, "y": {"type": "quantitative", "field": "Miles_per_Gallon"}}, "height": 200, "transform": [{"sample": 100}], "width": 200}], "data": {"url": "https://vega.github.io/vega-datasets/data/cars.json"}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-34', spec, opt).catch(console.err);
  });
</script>
</div><div class="section" id="id9">
<h3>Transform Options<a class="headerlink" href="#id9" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_sample" title="altair.Chart.transform_sample"><code class="xref py py-meth docutils literal"><span class="pre">transform_sample()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.SampleTransform.html#altair.SampleTransform" title="altair.SampleTransform"><code class="xref py py-class docutils literal"><span class="pre">SampleTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">sample</td>
<td><code class="docutils literal"><span class="pre">number</span></code></td>
<td class="vl-decsr"><p class="first">The maximum number of data objects to include in the sample.</p>
<p class="last"><strong>Default value:</strong> <code class="docutils literal"><span class="pre">1000</span></code></p>
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="stack-transform">
<span id="user-guide-stack-transform"></span><h2>Stack Transform<a class="headerlink" href="#stack-transform" title="Permalink to this headline">¶</a></h2>
<p>The stack transform allows you to compute values associated with stacked versions
of encodings. For example, consider this stacked bar chart:</p>
<div class="highlight-python" id="transform-rst-altair-source-35"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">barley</span><span class="p">()</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;yield:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;variety:N&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;site:N&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-35">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-093ece8c35bb2d41094cfb6138ec810b"}, "mark": "bar", "encoding": {"color": {"type": "nominal", "field": "site"}, "column": {"type": "ordinal", "field": "year"}, "x": {"type": "quantitative", "field": "yield"}, "y": {"type": "nominal", "field": "variety"}}, "width": 220, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-093ece8c35bb2d41094cfb6138ec810b": [{"site": "University Farm", "variety": "Manchuria", "year": 1931, "yield": 27.0}, {"site": "Waseca", "variety": "Manchuria", "year": 1931, "yield": 48.86667}, {"site": "Morris", "variety": "Manchuria", "year": 1931, "yield": 27.43334}, {"site": "Crookston", "variety": "Manchuria", "year": 1931, "yield": 39.93333}, {"site": "Grand Rapids", "variety": "Manchuria", "year": 1931, "yield": 32.96667}, {"site": "Duluth", "variety": "Manchuria", "year": 1931, "yield": 28.96667}, {"site": "University Farm", "variety": "Glabron", "year": 1931, "yield": 43.06666}, {"site": "Waseca", "variety": "Glabron", "year": 1931, "yield": 55.2}, {"site": "Morris", "variety": "Glabron", "year": 1931, "yield": 28.76667}, {"site": "Crookston", "variety": "Glabron", "year": 1931, "yield": 38.13333}, {"site": "Grand Rapids", "variety": "Glabron", "year": 1931, "yield": 29.13333}, {"site": "Duluth", "variety": "Glabron", "year": 1931, "yield": 29.66667}, {"site": "University Farm", "variety": "Svansota", "year": 1931, "yield": 35.13333}, {"site": "Waseca", "variety": "Svansota", "year": 1931, "yield": 47.33333}, {"site": "Morris", "variety": "Svansota", "year": 1931, "yield": 25.76667}, {"site": "Crookston", "variety": "Svansota", "year": 1931, "yield": 40.46667}, {"site": "Grand Rapids", "variety": "Svansota", "year": 1931, "yield": 29.66667}, {"site": "Duluth", "variety": "Svansota", "year": 1931, "yield": 25.7}, {"site": "University Farm", "variety": "Velvet", "year": 1931, "yield": 39.9}, {"site": "Waseca", "variety": "Velvet", "year": 1931, "yield": 50.23333}, {"site": "Morris", "variety": "Velvet", "year": 1931, "yield": 26.13333}, {"site": "Crookston", "variety": "Velvet", "year": 1931, "yield": 41.33333}, {"site": "Grand Rapids", "variety": "Velvet", "year": 1931, "yield": 23.03333}, {"site": "Duluth", "variety": "Velvet", "year": 1931, "yield": 26.3}, {"site": "University Farm", "variety": "Trebi", "year": 1931, "yield": 36.56666}, {"site": "Waseca", "variety": "Trebi", "year": 1931, "yield": 63.8333}, {"site": "Morris", "variety": "Trebi", "year": 1931, "yield": 43.76667}, {"site": "Crookston", "variety": "Trebi", "year": 1931, "yield": 46.93333}, {"site": "Grand Rapids", "variety": "Trebi", "year": 1931, "yield": 29.76667}, {"site": "Duluth", "variety": "Trebi", "year": 1931, "yield": 33.93333}, {"site": "University Farm", "variety": "No. 457", "year": 1931, "yield": 43.26667}, {"site": "Waseca", "variety": "No. 457", "year": 1931, "yield": 58.1}, {"site": "Morris", "variety": "No. 457", "year": 1931, "yield": 28.7}, {"site": "Crookston", "variety": "No. 457", "year": 1931, "yield": 45.66667}, {"site": "Grand Rapids", "variety": "No. 457", "year": 1931, "yield": 32.16667}, {"site": "Duluth", "variety": "No. 457", "year": 1931, "yield": 33.6}, {"site": "University Farm", "variety": "No. 462", "year": 1931, "yield": 36.6}, {"site": "Waseca", "variety": "No. 462", "year": 1931, "yield": 65.7667}, {"site": "Morris", "variety": "No. 462", "year": 1931, "yield": 30.36667}, {"site": "Crookston", "variety": "No. 462", "year": 1931, "yield": 48.56666}, {"site": "Grand Rapids", "variety": "No. 462", "year": 1931, "yield": 24.93334}, {"site": "Duluth", "variety": "No. 462", "year": 1931, "yield": 28.1}, {"site": "University Farm", "variety": "Peatland", "year": 1931, "yield": 32.76667}, {"site": "Waseca", "variety": "Peatland", "year": 1931, "yield": 48.56666}, {"site": "Morris", "variety": "Peatland", "year": 1931, "yield": 29.86667}, {"site": "Crookston", "variety": "Peatland", "year": 1931, "yield": 41.6}, {"site": "Grand Rapids", "variety": "Peatland", "year": 1931, "yield": 34.7}, {"site": "Duluth", "variety": "Peatland", "year": 1931, "yield": 32.0}, {"site": "University Farm", "variety": "No. 475", "year": 1931, "yield": 24.66667}, {"site": "Waseca", "variety": "No. 475", "year": 1931, "yield": 46.76667}, {"site": "Morris", "variety": "No. 475", "year": 1931, "yield": 22.6}, {"site": "Crookston", "variety": "No. 475", "year": 1931, "yield": 44.1}, {"site": "Grand Rapids", "variety": "No. 475", "year": 1931, "yield": 19.7}, {"site": "Duluth", "variety": "No. 475", "year": 1931, "yield": 33.06666}, {"site": "University Farm", "variety": "Wisconsin No. 38", "year": 1931, "yield": 39.3}, {"site": "Waseca", "variety": "Wisconsin No. 38", "year": 1931, "yield": 58.8}, {"site": "Morris", "variety": "Wisconsin No. 38", "year": 1931, "yield": 29.46667}, {"site": "Crookston", "variety": "Wisconsin No. 38", "year": 1931, "yield": 49.86667}, {"site": "Grand Rapids", "variety": "Wisconsin No. 38", "year": 1931, "yield": 34.46667}, {"site": "Duluth", "variety": "Wisconsin No. 38", "year": 1931, "yield": 31.6}, {"site": "University Farm", "variety": "Manchuria", "year": 1932, "yield": 26.9}, {"site": "Waseca", "variety": "Manchuria", "year": 1932, "yield": 33.46667}, {"site": "Morris", "variety": "Manchuria", "year": 1932, "yield": 34.36666}, {"site": "Crookston", "variety": "Manchuria", "year": 1932, "yield": 32.96667}, {"site": "Grand Rapids", "variety": "Manchuria", "year": 1932, "yield": 22.13333}, {"site": "Duluth", "variety": "Manchuria", "year": 1932, "yield": 22.56667}, {"site": "University Farm", "variety": "Glabron", "year": 1932, "yield": 36.8}, {"site": "Waseca", "variety": "Glabron", "year": 1932, "yield": 37.73333}, {"site": "Morris", "variety": "Glabron", "year": 1932, "yield": 35.13333}, {"site": "Crookston", "variety": "Glabron", "year": 1932, "yield": 26.16667}, {"site": "Grand Rapids", "variety": "Glabron", "year": 1932, "yield": 14.43333}, {"site": "Duluth", "variety": "Glabron", "year": 1932, "yield": 25.86667}, {"site": "University Farm", "variety": "Svansota", "year": 1932, "yield": 27.43334}, {"site": "Waseca", "variety": "Svansota", "year": 1932, "yield": 38.5}, {"site": "Morris", "variety": "Svansota", "year": 1932, "yield": 35.03333}, {"site": "Crookston", "variety": "Svansota", "year": 1932, "yield": 20.63333}, {"site": "Grand Rapids", "variety": "Svansota", "year": 1932, "yield": 16.63333}, {"site": "Duluth", "variety": "Svansota", "year": 1932, "yield": 22.23333}, {"site": "University Farm", "variety": "Velvet", "year": 1932, "yield": 26.8}, {"site": "Waseca", "variety": "Velvet", "year": 1932, "yield": 37.4}, {"site": "Morris", "variety": "Velvet", "year": 1932, "yield": 38.83333}, {"site": "Crookston", "variety": "Velvet", "year": 1932, "yield": 32.06666}, {"site": "Grand Rapids", "variety": "Velvet", "year": 1932, "yield": 32.23333}, {"site": "Duluth", "variety": "Velvet", "year": 1932, "yield": 22.46667}, {"site": "University Farm", "variety": "Trebi", "year": 1932, "yield": 29.06667}, {"site": "Waseca", "variety": "Trebi", "year": 1932, "yield": 49.2333}, {"site": "Morris", "variety": "Trebi", "year": 1932, "yield": 46.63333}, {"site": "Crookston", "variety": "Trebi", "year": 1932, "yield": 41.83333}, {"site": "Grand Rapids", "variety": "Trebi", "year": 1932, "yield": 20.63333}, {"site": "Duluth", "variety": "Trebi", "year": 1932, "yield": 30.6}, {"site": "University Farm", "variety": "No. 457", "year": 1932, "yield": 26.43334}, {"site": "Waseca", "variety": "No. 457", "year": 1932, "yield": 42.2}, {"site": "Morris", "variety": "No. 457", "year": 1932, "yield": 43.53334}, {"site": "Crookston", "variety": "No. 457", "year": 1932, "yield": 34.33333}, {"site": "Grand Rapids", "variety": "No. 457", "year": 1932, "yield": 19.46667}, {"site": "Duluth", "variety": "No. 457", "year": 1932, "yield": 22.7}, {"site": "University Farm", "variety": "No. 462", "year": 1932, "yield": 25.56667}, {"site": "Waseca", "variety": "No. 462", "year": 1932, "yield": 44.7}, {"site": "Morris", "variety": "No. 462", "year": 1932, "yield": 47.0}, {"site": "Crookston", "variety": "No. 462", "year": 1932, "yield": 30.53333}, {"site": "Grand Rapids", "variety": "No. 462", "year": 1932, "yield": 19.9}, {"site": "Duluth", "variety": "No. 462", "year": 1932, "yield": 22.5}, {"site": "University Farm", "variety": "Peatland", "year": 1932, "yield": 28.06667}, {"site": "Waseca", "variety": "Peatland", "year": 1932, "yield": 36.03333}, {"site": "Morris", "variety": "Peatland", "year": 1932, "yield": 43.2}, {"site": "Crookston", "variety": "Peatland", "year": 1932, "yield": 25.23333}, {"site": "Grand Rapids", "variety": "Peatland", "year": 1932, "yield": 26.76667}, {"site": "Duluth", "variety": "Peatland", "year": 1932, "yield": 31.36667}, {"site": "University Farm", "variety": "No. 475", "year": 1932, "yield": 30.0}, {"site": "Waseca", "variety": "No. 475", "year": 1932, "yield": 41.26667}, {"site": "Morris", "variety": "No. 475", "year": 1932, "yield": 44.23333}, {"site": "Crookston", "variety": "No. 475", "year": 1932, "yield": 32.13333}, {"site": "Grand Rapids", "variety": "No. 475", "year": 1932, "yield": 15.23333}, {"site": "Duluth", "variety": "No. 475", "year": 1932, "yield": 27.36667}, {"site": "University Farm", "variety": "Wisconsin No. 38", "year": 1932, "yield": 38.0}, {"site": "Waseca", "variety": "Wisconsin No. 38", "year": 1932, "yield": 58.16667}, {"site": "Morris", "variety": "Wisconsin No. 38", "year": 1932, "yield": 47.16667}, {"site": "Crookston", "variety": "Wisconsin No. 38", "year": 1932, "yield": 35.9}, {"site": "Grand Rapids", "variety": "Wisconsin No. 38", "year": 1932, "yield": 20.66667}, {"site": "Duluth", "variety": "Wisconsin No. 38", "year": 1932, "yield": 29.33333}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-35', spec, opt).catch(console.err);
  });
</script>
</div><p>Implicitly, this data is being grouped and stacked, but what if you would like to
access those stacked values directly?
We can construct that same chart manually using the stack transform:</p>
<div class="highlight-python" id="transform-rst-altair-source-36"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">source</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">barley</span><span class="p">()</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">source</span><span class="p">)</span><span class="o">.</span><span class="n">transform_stack</span><span class="p">(</span>
    <span class="n">stack</span><span class="o">=</span><span class="s1">&#39;yield&#39;</span><span class="p">,</span>
    <span class="n">as_</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;yield_1&#39;</span><span class="p">,</span> <span class="s1">&#39;yield_2&#39;</span><span class="p">],</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;variety&#39;</span><span class="p">],</span>
    <span class="n">sort</span><span class="o">=</span><span class="p">[</span><span class="n">alt</span><span class="o">.</span><span class="n">SortField</span><span class="p">(</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;descending&#39;</span><span class="p">)]</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">column</span><span class="o">=</span><span class="s1">&#39;year:O&#39;</span><span class="p">,</span>
    <span class="n">x</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;yield_1:Q&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;yield&#39;</span><span class="p">),</span>
    <span class="n">x2</span><span class="o">=</span><span class="s1">&#39;yield_2:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;variety:N&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;site:N&#39;</span><span class="p">,</span>
    <span class="n">tooltip</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;site&#39;</span><span class="p">,</span> <span class="s1">&#39;yield&#39;</span><span class="p">,</span> <span class="s1">&#39;variety&#39;</span><span class="p">]</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">220</span><span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-36">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"name": "data-093ece8c35bb2d41094cfb6138ec810b"}, "mark": "bar", "encoding": {"color": {"type": "nominal", "field": "site"}, "column": {"type": "ordinal", "field": "year"}, "tooltip": [{"type": "nominal", "field": "site"}, {"type": "quantitative", "field": "yield"}, {"type": "nominal", "field": "variety"}], "x": {"type": "quantitative", "field": "yield_1", "title": "yield"}, "x2": {"field": "yield_2"}, "y": {"type": "nominal", "field": "variety"}}, "transform": [{"groupby": ["year", "variety"], "stack": "yield", "sort": [{"field": "site", "order": "descending"}], "as": ["yield_1", "yield_2"]}], "width": 220, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json", "datasets": {"data-093ece8c35bb2d41094cfb6138ec810b": [{"site": "University Farm", "variety": "Manchuria", "year": 1931, "yield": 27.0}, {"site": "Waseca", "variety": "Manchuria", "year": 1931, "yield": 48.86667}, {"site": "Morris", "variety": "Manchuria", "year": 1931, "yield": 27.43334}, {"site": "Crookston", "variety": "Manchuria", "year": 1931, "yield": 39.93333}, {"site": "Grand Rapids", "variety": "Manchuria", "year": 1931, "yield": 32.96667}, {"site": "Duluth", "variety": "Manchuria", "year": 1931, "yield": 28.96667}, {"site": "University Farm", "variety": "Glabron", "year": 1931, "yield": 43.06666}, {"site": "Waseca", "variety": "Glabron", "year": 1931, "yield": 55.2}, {"site": "Morris", "variety": "Glabron", "year": 1931, "yield": 28.76667}, {"site": "Crookston", "variety": "Glabron", "year": 1931, "yield": 38.13333}, {"site": "Grand Rapids", "variety": "Glabron", "year": 1931, "yield": 29.13333}, {"site": "Duluth", "variety": "Glabron", "year": 1931, "yield": 29.66667}, {"site": "University Farm", "variety": "Svansota", "year": 1931, "yield": 35.13333}, {"site": "Waseca", "variety": "Svansota", "year": 1931, "yield": 47.33333}, {"site": "Morris", "variety": "Svansota", "year": 1931, "yield": 25.76667}, {"site": "Crookston", "variety": "Svansota", "year": 1931, "yield": 40.46667}, {"site": "Grand Rapids", "variety": "Svansota", "year": 1931, "yield": 29.66667}, {"site": "Duluth", "variety": "Svansota", "year": 1931, "yield": 25.7}, {"site": "University Farm", "variety": "Velvet", "year": 1931, "yield": 39.9}, {"site": "Waseca", "variety": "Velvet", "year": 1931, "yield": 50.23333}, {"site": "Morris", "variety": "Velvet", "year": 1931, "yield": 26.13333}, {"site": "Crookston", "variety": "Velvet", "year": 1931, "yield": 41.33333}, {"site": "Grand Rapids", "variety": "Velvet", "year": 1931, "yield": 23.03333}, {"site": "Duluth", "variety": "Velvet", "year": 1931, "yield": 26.3}, {"site": "University Farm", "variety": "Trebi", "year": 1931, "yield": 36.56666}, {"site": "Waseca", "variety": "Trebi", "year": 1931, "yield": 63.8333}, {"site": "Morris", "variety": "Trebi", "year": 1931, "yield": 43.76667}, {"site": "Crookston", "variety": "Trebi", "year": 1931, "yield": 46.93333}, {"site": "Grand Rapids", "variety": "Trebi", "year": 1931, "yield": 29.76667}, {"site": "Duluth", "variety": "Trebi", "year": 1931, "yield": 33.93333}, {"site": "University Farm", "variety": "No. 457", "year": 1931, "yield": 43.26667}, {"site": "Waseca", "variety": "No. 457", "year": 1931, "yield": 58.1}, {"site": "Morris", "variety": "No. 457", "year": 1931, "yield": 28.7}, {"site": "Crookston", "variety": "No. 457", "year": 1931, "yield": 45.66667}, {"site": "Grand Rapids", "variety": "No. 457", "year": 1931, "yield": 32.16667}, {"site": "Duluth", "variety": "No. 457", "year": 1931, "yield": 33.6}, {"site": "University Farm", "variety": "No. 462", "year": 1931, "yield": 36.6}, {"site": "Waseca", "variety": "No. 462", "year": 1931, "yield": 65.7667}, {"site": "Morris", "variety": "No. 462", "year": 1931, "yield": 30.36667}, {"site": "Crookston", "variety": "No. 462", "year": 1931, "yield": 48.56666}, {"site": "Grand Rapids", "variety": "No. 462", "year": 1931, "yield": 24.93334}, {"site": "Duluth", "variety": "No. 462", "year": 1931, "yield": 28.1}, {"site": "University Farm", "variety": "Peatland", "year": 1931, "yield": 32.76667}, {"site": "Waseca", "variety": "Peatland", "year": 1931, "yield": 48.56666}, {"site": "Morris", "variety": "Peatland", "year": 1931, "yield": 29.86667}, {"site": "Crookston", "variety": "Peatland", "year": 1931, "yield": 41.6}, {"site": "Grand Rapids", "variety": "Peatland", "year": 1931, "yield": 34.7}, {"site": "Duluth", "variety": "Peatland", "year": 1931, "yield": 32.0}, {"site": "University Farm", "variety": "No. 475", "year": 1931, "yield": 24.66667}, {"site": "Waseca", "variety": "No. 475", "year": 1931, "yield": 46.76667}, {"site": "Morris", "variety": "No. 475", "year": 1931, "yield": 22.6}, {"site": "Crookston", "variety": "No. 475", "year": 1931, "yield": 44.1}, {"site": "Grand Rapids", "variety": "No. 475", "year": 1931, "yield": 19.7}, {"site": "Duluth", "variety": "No. 475", "year": 1931, "yield": 33.06666}, {"site": "University Farm", "variety": "Wisconsin No. 38", "year": 1931, "yield": 39.3}, {"site": "Waseca", "variety": "Wisconsin No. 38", "year": 1931, "yield": 58.8}, {"site": "Morris", "variety": "Wisconsin No. 38", "year": 1931, "yield": 29.46667}, {"site": "Crookston", "variety": "Wisconsin No. 38", "year": 1931, "yield": 49.86667}, {"site": "Grand Rapids", "variety": "Wisconsin No. 38", "year": 1931, "yield": 34.46667}, {"site": "Duluth", "variety": "Wisconsin No. 38", "year": 1931, "yield": 31.6}, {"site": "University Farm", "variety": "Manchuria", "year": 1932, "yield": 26.9}, {"site": "Waseca", "variety": "Manchuria", "year": 1932, "yield": 33.46667}, {"site": "Morris", "variety": "Manchuria", "year": 1932, "yield": 34.36666}, {"site": "Crookston", "variety": "Manchuria", "year": 1932, "yield": 32.96667}, {"site": "Grand Rapids", "variety": "Manchuria", "year": 1932, "yield": 22.13333}, {"site": "Duluth", "variety": "Manchuria", "year": 1932, "yield": 22.56667}, {"site": "University Farm", "variety": "Glabron", "year": 1932, "yield": 36.8}, {"site": "Waseca", "variety": "Glabron", "year": 1932, "yield": 37.73333}, {"site": "Morris", "variety": "Glabron", "year": 1932, "yield": 35.13333}, {"site": "Crookston", "variety": "Glabron", "year": 1932, "yield": 26.16667}, {"site": "Grand Rapids", "variety": "Glabron", "year": 1932, "yield": 14.43333}, {"site": "Duluth", "variety": "Glabron", "year": 1932, "yield": 25.86667}, {"site": "University Farm", "variety": "Svansota", "year": 1932, "yield": 27.43334}, {"site": "Waseca", "variety": "Svansota", "year": 1932, "yield": 38.5}, {"site": "Morris", "variety": "Svansota", "year": 1932, "yield": 35.03333}, {"site": "Crookston", "variety": "Svansota", "year": 1932, "yield": 20.63333}, {"site": "Grand Rapids", "variety": "Svansota", "year": 1932, "yield": 16.63333}, {"site": "Duluth", "variety": "Svansota", "year": 1932, "yield": 22.23333}, {"site": "University Farm", "variety": "Velvet", "year": 1932, "yield": 26.8}, {"site": "Waseca", "variety": "Velvet", "year": 1932, "yield": 37.4}, {"site": "Morris", "variety": "Velvet", "year": 1932, "yield": 38.83333}, {"site": "Crookston", "variety": "Velvet", "year": 1932, "yield": 32.06666}, {"site": "Grand Rapids", "variety": "Velvet", "year": 1932, "yield": 32.23333}, {"site": "Duluth", "variety": "Velvet", "year": 1932, "yield": 22.46667}, {"site": "University Farm", "variety": "Trebi", "year": 1932, "yield": 29.06667}, {"site": "Waseca", "variety": "Trebi", "year": 1932, "yield": 49.2333}, {"site": "Morris", "variety": "Trebi", "year": 1932, "yield": 46.63333}, {"site": "Crookston", "variety": "Trebi", "year": 1932, "yield": 41.83333}, {"site": "Grand Rapids", "variety": "Trebi", "year": 1932, "yield": 20.63333}, {"site": "Duluth", "variety": "Trebi", "year": 1932, "yield": 30.6}, {"site": "University Farm", "variety": "No. 457", "year": 1932, "yield": 26.43334}, {"site": "Waseca", "variety": "No. 457", "year": 1932, "yield": 42.2}, {"site": "Morris", "variety": "No. 457", "year": 1932, "yield": 43.53334}, {"site": "Crookston", "variety": "No. 457", "year": 1932, "yield": 34.33333}, {"site": "Grand Rapids", "variety": "No. 457", "year": 1932, "yield": 19.46667}, {"site": "Duluth", "variety": "No. 457", "year": 1932, "yield": 22.7}, {"site": "University Farm", "variety": "No. 462", "year": 1932, "yield": 25.56667}, {"site": "Waseca", "variety": "No. 462", "year": 1932, "yield": 44.7}, {"site": "Morris", "variety": "No. 462", "year": 1932, "yield": 47.0}, {"site": "Crookston", "variety": "No. 462", "year": 1932, "yield": 30.53333}, {"site": "Grand Rapids", "variety": "No. 462", "year": 1932, "yield": 19.9}, {"site": "Duluth", "variety": "No. 462", "year": 1932, "yield": 22.5}, {"site": "University Farm", "variety": "Peatland", "year": 1932, "yield": 28.06667}, {"site": "Waseca", "variety": "Peatland", "year": 1932, "yield": 36.03333}, {"site": "Morris", "variety": "Peatland", "year": 1932, "yield": 43.2}, {"site": "Crookston", "variety": "Peatland", "year": 1932, "yield": 25.23333}, {"site": "Grand Rapids", "variety": "Peatland", "year": 1932, "yield": 26.76667}, {"site": "Duluth", "variety": "Peatland", "year": 1932, "yield": 31.36667}, {"site": "University Farm", "variety": "No. 475", "year": 1932, "yield": 30.0}, {"site": "Waseca", "variety": "No. 475", "year": 1932, "yield": 41.26667}, {"site": "Morris", "variety": "No. 475", "year": 1932, "yield": 44.23333}, {"site": "Crookston", "variety": "No. 475", "year": 1932, "yield": 32.13333}, {"site": "Grand Rapids", "variety": "No. 475", "year": 1932, "yield": 15.23333}, {"site": "Duluth", "variety": "No. 475", "year": 1932, "yield": 27.36667}, {"site": "University Farm", "variety": "Wisconsin No. 38", "year": 1932, "yield": 38.0}, {"site": "Waseca", "variety": "Wisconsin No. 38", "year": 1932, "yield": 58.16667}, {"site": "Morris", "variety": "Wisconsin No. 38", "year": 1932, "yield": 47.16667}, {"site": "Crookston", "variety": "Wisconsin No. 38", "year": 1932, "yield": 35.9}, {"site": "Grand Rapids", "variety": "Wisconsin No. 38", "year": 1932, "yield": 20.66667}, {"site": "Duluth", "variety": "Wisconsin No. 38", "year": 1932, "yield": 29.33333}]}};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-36', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice that the bars are now explicitly drawn between values computed and
specified within the x and x2 encodings.</p>
<div class="section" id="id10">
<h3>Transform Options<a class="headerlink" href="#id10" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_stack" title="altair.Chart.transform_stack"><code class="xref py py-meth docutils literal"><span class="pre">transform_stack()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.StackTransform.html#altair.StackTransform" title="altair.StackTransform"><code class="xref py py-class docutils literal"><span class="pre">StackTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td>anyOf(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>, array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>))</td>
<td class="vl-decsr">Output field names. This can be either a string or an array of strings with
two elements denoting the name for the fields for stack start and stack end
respectively.
If a single string(eg.”val”) is provided, the end field will be “val_end”.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">groupby</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr">The data fields to group by.</td>
</tr>
<tr class="row-even"><td class="vl-prop">offset</td>
<td>[‘zero’, ‘center’, ‘normalize’]</td>
<td class="vl-decsr">Mode for stacking marks.
<strong>Default value:</strong> <code class="docutils literal"><span class="pre">&quot;zero&quot;</span></code></td>
</tr>
<tr class="row-odd"><td class="vl-prop">sort</td>
<td>array(<a class="reference internal" href="generated/core/altair.SortField.html#altair.SortField" title="altair.SortField"><code class="xref py py-class docutils literal"><span class="pre">SortField</span></code></a>)</td>
<td class="vl-decsr">Field that determines the order of leaves in the stacked charts.</td>
</tr>
<tr class="row-even"><td class="vl-prop">stack</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The field which is stacked.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="timeunit-transform">
<span id="user-guide-timeunit-transform"></span><h2>TimeUnit Transform<a class="headerlink" href="#timeunit-transform" title="Permalink to this headline">¶</a></h2>
<p>TimeUnit transforms are used to discretize dates and times within Altair.
As with the <a class="reference internal" href="#user-guide-aggregate-transform"><span class="std std-ref">Aggregate Transforms</span></a> and <a class="reference internal" href="#user-guide-bin-transform"><span class="std std-ref">Bin transforms</span></a>
discussed above, they can be defined either as part of the encoding, or as a
top-level transform.</p>
<p>These are the available time units:</p>
<ul class="simple">
<li><code class="docutils literal"><span class="pre">&quot;year&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearquarter&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearquartermonth&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearmonth&quot;</span></code>,
<code class="docutils literal"><span class="pre">&quot;yearmonthdate&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearmonthdatehours&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;yearmonthdatehoursminutes&quot;</span></code>,
<code class="docutils literal"><span class="pre">&quot;yearmonthdatehoursseconds&quot;</span></code>.</li>
<li><code class="docutils literal"><span class="pre">&quot;quarter&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;quartermonth&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;month&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;monthdate&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;date&quot;</span></code> (Day of month, i.e., 1 - 31)</li>
<li><code class="docutils literal"><span class="pre">&quot;day&quot;</span></code> (Day of week, i.e., Monday - Friday)</li>
<li><code class="docutils literal"><span class="pre">&quot;hours&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;hoursminutes&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;hoursminutesseconds&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;minutes&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;minutesseconds&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;seconds&quot;</span></code>, <code class="docutils literal"><span class="pre">&quot;secondsmilliseconds&quot;</span></code></li>
<li><code class="docutils literal"><span class="pre">&quot;milliseconds&quot;</span></code></li>
</ul>
<div class="section" id="timeunit-within-encoding">
<h3>TimeUnit Within Encoding<a class="headerlink" href="#timeunit-within-encoding" title="Permalink to this headline">¶</a></h3>
<p>Any temporal field definition can include a <code class="docutils literal"><span class="pre">timeUnit</span></code> argument to discretize
the temporal data.</p>
<p>For example, here we plot a dataset that consists of hourly temperature
measurements in Seattle during the year 2010:</p>
<div class="highlight-python" id="transform-rst-altair-source-37"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">temps</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">seattle_temps</span><span class="o">.</span><span class="n">url</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;temp:Q&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-37">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "line", "encoding": {"x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "temp"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-37', spec, opt).catch(console.err);
  });
</script>
</div><p>The plot is too busy due to the amount of data points squeezed into the short
time; we can make it a bit cleaner by discretizing it, for example, by month
and plotting only the mean monthly temperature:</p>
<div class="highlight-python" id="transform-rst-altair-source-38"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month(date):T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(temp):Q&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-38">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "line", "encoding": {"x": {"type": "temporal", "field": "date", "timeUnit": "month"}, "y": {"type": "quantitative", "aggregate": "mean", "field": "temp"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-38', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice that by default timeUnit output is a continuous quantity; if you would
instead like it to be a categorical, you can specify the ordinal (<code class="docutils literal"><span class="pre">O</span></code>) or
nominal (<code class="docutils literal"><span class="pre">N</span></code>) type.
This can be useful when plotting a bar chart or other discrete chart type:</p>
<div class="highlight-python" id="transform-rst-altair-source-39"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_bar</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(temp):Q&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-39">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "bar", "encoding": {"x": {"type": "ordinal", "field": "date", "timeUnit": "month"}, "y": {"type": "quantitative", "aggregate": "mean", "field": "temp"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-39', spec, opt).catch(console.err);
  });
</script>
</div><p>Multiple time units can be combined within a single plot to yield interesting
views of your data; for example, here we extract both the month and the day
to give a profile of Seattle temperatures through the year:</p>
<div class="highlight-python" id="transform-rst-altair-source-40"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_rect</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;date(date):O&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;day&#39;</span><span class="p">),</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">Y</span><span class="p">(</span><span class="s1">&#39;month(date):O&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;month&#39;</span><span class="p">),</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;max(temp):Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">properties</span><span class="p">(</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;2010 Daily High Temperatures in Seattle (F)&quot;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-40">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "rect", "encoding": {"color": {"type": "quantitative", "aggregate": "max", "field": "temp"}, "x": {"type": "ordinal", "field": "date", "timeUnit": "date", "title": "day"}, "y": {"type": "ordinal", "field": "date", "timeUnit": "month", "title": "month"}}, "title": "2010 Daily High Temperatures in Seattle (F)", "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-40', spec, opt).catch(console.err);
  });
</script>
</div></div>
<div class="section" id="timeunit-as-a-transform">
<h3>TimeUnit as a Transform<a class="headerlink" href="#timeunit-as-a-transform" title="Permalink to this headline">¶</a></h3>
<p>Other times it is convenient to specify a timeUnit as a top-level transform,
particularly when the value may be reused.
This can be done most conveniently using the <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_timeunit" title="altair.Chart.transform_timeunit"><code class="xref py py-meth docutils literal"><span class="pre">Chart.transform_timeunit()</span></code></a>
method. For example:</p>
<div class="highlight-python" id="transform-rst-altair-source-41"><div class="highlight"><pre><span></span><span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">temps</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">alt</span><span class="o">.</span><span class="n">X</span><span class="p">(</span><span class="s1">&#39;month:T&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">alt</span><span class="o">.</span><span class="n">Axis</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="s1">&#39;%b&#39;</span><span class="p">)),</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;mean(temp):Q&#39;</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_timeunit</span><span class="p">(</span>
    <span class="n">month</span><span class="o">=</span><span class="s1">&#39;month(date)&#39;</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-41">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/seattle-temps.csv"}, "mark": "line", "encoding": {"x": {"type": "temporal", "axis": {"format": "%b"}, "field": "month"}, "y": {"type": "quantitative", "aggregate": "mean", "field": "temp"}}, "transform": [{"field": "date", "timeUnit": "month", "as": "month"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-41', spec, opt).catch(console.err);
  });
</script>
</div><p>Notice that because the <code class="docutils literal"><span class="pre">timeUnit</span></code> is not part of the encoding channel here,
it is often necessary to add an axis formatter to ensure appropriate axis
labels.</p>
</div>
<div class="section" id="id11">
<h3>Transform Options<a class="headerlink" href="#id11" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_timeunit" title="altair.Chart.transform_timeunit"><code class="xref py py-meth docutils literal"><span class="pre">transform_timeunit()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.TimeUnitTransform.html#altair.TimeUnitTransform" title="altair.TimeUnitTransform"><code class="xref py py-class docutils literal"><span class="pre">TimeUnitTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">as</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The output field to write the timeUnit value.</td>
</tr>
<tr class="row-odd"><td class="vl-prop">field</td>
<td><a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a></td>
<td class="vl-decsr">The data field to apply time unit.</td>
</tr>
<tr class="row-even"><td class="vl-prop">timeUnit</td>
<td><a class="reference internal" href="generated/core/altair.TimeUnit.html#altair.TimeUnit" title="altair.TimeUnit"><code class="xref py py-class docutils literal"><span class="pre">TimeUnit</span></code></a></td>
<td class="vl-decsr">The timeUnit.</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section" id="window-transform">
<span id="user-guide-window-transform"></span><h2>Window Transform<a class="headerlink" href="#window-transform" title="Permalink to this headline">¶</a></h2>
<p>The window transform performs calculations over sorted groups of data objects.
These calculations include ranking, lead/lag analysis, and aggregates such as cumulative sums and averages.
Calculated values are written back to the input data stream, where they can be referenced by encodings.</p>
<p>For example, consider the following cumulative frequency distribution:</p>
<div class="highlight-python" id="transform-rst-altair-source-42"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">movies</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
    <span class="n">sort</span><span class="o">=</span><span class="p">[{</span><span class="s1">&#39;field&#39;</span><span class="p">:</span> <span class="s1">&#39;IMDB_Rating&#39;</span><span class="p">}],</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
    <span class="n">cumulative_count</span><span class="o">=</span><span class="s1">&#39;count(*)&#39;</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_area</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;IMDB_Rating:Q&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;cumulative_count:Q&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-42">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/movies.json"}, "mark": "area", "encoding": {"x": {"type": "quantitative", "field": "IMDB_Rating"}, "y": {"type": "quantitative", "field": "cumulative_count"}}, "transform": [{"window": [{"op": "count", "field": "*", "as": "cumulative_count"}], "frame": [null, 0], "sort": [{"field": "IMDB_Rating"}]}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-42', spec, opt).catch(console.err);
  });
</script>
</div><p>First, we pass a sort field definition, which indicates how data objects should be sorted within the window.
Here, movies should be sorted by their IMDB rating.
Next, we pass the frame, which indicates how many data objects before and after the current data object should be included within the window.
Here, all movies up to and including the current movie should be included.
Finally, we pass a window field definition, which indicates how data objects should be aggregated within the window.
Here, the number of movies should be counted.</p>
<p>There are many aggregation functions built into Altair.
As well as those given in <a class="reference internal" href="encoding.html#encoding-aggregates"><span class="std std-ref">Binning and Aggregation</span></a>, we can use the following within window field definitions:</p>
<table border="1" class="docutils">
<colgroup>
<col width="4%" />
<col width="3%" />
<col width="94%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Aggregate</th>
<th class="head">Parameter</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>row_number</td>
<td>None</td>
<td>Assigns each data object a consecutive row number, starting from 1.</td>
</tr>
<tr class="row-odd"><td>rank</td>
<td>None</td>
<td>Assigns a rank order value to each data object in a window, starting from 1. Peer values are assigned the same rank. Subsequent rank scores incorporate the number of prior values. For example, if the first two values tie for rank 1, the third value is assigned rank 3.</td>
</tr>
<tr class="row-even"><td>dense_rank</td>
<td>None</td>
<td>Assigns dense rank order values to each data object in a window, starting from 1. Peer values are assigned the same rank. Subsequent rank scores do not incorporate the number of prior values. For example, if the first two values tie for rank 1, the third value is assigned rank 2.</td>
</tr>
<tr class="row-odd"><td>percent_rank</td>
<td>None</td>
<td>Assigns a percentage rank order value to each data object in a window. The percent is calculated as (rank - 1) / (group_size - 1).</td>
</tr>
<tr class="row-even"><td>cume_dist</td>
<td>None</td>
<td>Assigns a cumulative distribution value between 0 and 1 to each data object in a window.</td>
</tr>
<tr class="row-odd"><td>ntile</td>
<td>Number</td>
<td>Assigns a quantile (e.g., percentile) value to each data object in a window. Accepts an integer parameter indicating the number of buckets to use (e.g., 100 for percentiles, 5 for quintiles).</td>
</tr>
<tr class="row-even"><td>lag</td>
<td>Number</td>
<td>Assigns a value from the data object that precedes the current object by a specified number of positions. If no such object exists, assigns <code class="docutils literal"><span class="pre">null</span></code>. Accepts an offset parameter (default <code class="docutils literal"><span class="pre">1</span></code>) that indicates the number of positions. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-odd"><td>lead</td>
<td>Number</td>
<td>Assigns a value from the data object that follows the current object by a specified number of positions. If no such object exists, assigns <code class="docutils literal"><span class="pre">null</span></code>. Accepts an offset parameter (default <code class="docutils literal"><span class="pre">1</span></code>) that indicates the number of positions. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-even"><td>first_value</td>
<td>None</td>
<td>Assigns a value from the first data object in the current sliding window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-odd"><td>last_value</td>
<td>None</td>
<td>Assigns a value from the last data object in the current sliding window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
<tr class="row-even"><td>nth_value</td>
<td>Number</td>
<td>Assigns a value from the nth data object in the current sliding window frame. If no such object exists, assigns <code class="docutils literal"><span class="pre">null</span></code>. Requires a non-negative integer parameter that indicates the offset from the start of the window frame. This operation must have a corresponding entry in the <cite>fields</cite> parameter array.</td>
</tr>
</tbody>
</table>
<p>While an aggregate transform computes a single value that summarises all data objects, a window transform adds a new property to each data object.
This new property is computed from the neighbouring data objects: that is, from the data objects delimited by the window field definition.
For example, consider the following time series of stock prices:</p>
<div class="highlight-python" id="transform-rst-altair-source-43"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">stocks</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;price:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;symbol:N&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-43">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/stocks.csv"}, "mark": "line", "encoding": {"color": {"type": "nominal", "field": "symbol"}, "x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "price"}}, "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-43', spec, opt).catch(console.err);
  });
</script>
</div><p>It’s hard to see the overall pattern in the above example, because Google’s stock price is much higher than the other stock prices.
If we plot the <a class="reference external" href="https://en.wikipedia.org/w/index.php?title=Z-score">z-scores</a> of the stock prices, rather than the stock prices themselves, then the overall pattern becomes clearer:</p>
<div class="highlight-python" id="transform-rst-altair-source-44"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">altair</span> <span class="kn">as</span> <span class="nn">alt</span>
<span class="kn">from</span> <span class="nn">vega_datasets</span> <span class="kn">import</span> <span class="n">data</span>

<span class="n">alt</span><span class="o">.</span><span class="n">Chart</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">stocks</span><span class="o">.</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">transform_window</span><span class="p">(</span>
    <span class="n">mean_price</span><span class="o">=</span><span class="s1">&#39;mean(price)&#39;</span><span class="p">,</span>
    <span class="n">stdev_price</span><span class="o">=</span><span class="s1">&#39;stdev(price)&#39;</span><span class="p">,</span>
    <span class="n">frame</span><span class="o">=</span><span class="p">[</span><span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">],</span>
    <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;symbol&#39;</span><span class="p">],</span>
<span class="p">)</span><span class="o">.</span><span class="n">transform_calculate</span><span class="p">(</span>
    <span class="n">z_score</span><span class="o">=</span><span class="p">(</span><span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">price</span> <span class="o">-</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">mean_price</span><span class="p">)</span> <span class="o">/</span> <span class="n">alt</span><span class="o">.</span><span class="n">datum</span><span class="o">.</span><span class="n">stdev_price</span><span class="p">,</span>
<span class="p">)</span><span class="o">.</span><span class="n">mark_line</span><span class="p">()</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="s1">&#39;date:T&#39;</span><span class="p">,</span>
    <span class="n">y</span><span class="o">=</span><span class="s1">&#39;z_score:Q&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s1">&#39;symbol:N&#39;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>

<div id="transform-rst-altair-plot-44">
<script>
  // embed when document is loaded, to ensure vega library is available
  // this works on all modern browsers, except IE8 and older
  document.addEventListener("DOMContentLoaded", function(event) {
      var spec = {"config": {"view": {"width": 400, "height": 300}, "mark": {"tooltip": null}}, "data": {"url": "https://vega.github.io/vega-datasets/data/stocks.csv"}, "mark": "line", "encoding": {"color": {"type": "nominal", "field": "symbol"}, "x": {"type": "temporal", "field": "date"}, "y": {"type": "quantitative", "field": "z_score"}}, "transform": [{"window": [{"op": "mean", "field": "price", "as": "mean_price"}, {"op": "stdev", "field": "price", "as": "stdev_price"}], "frame": [null, null], "groupby": ["symbol"]}, {"calculate": "((datum.price - datum.mean_price) / datum.stdev_price)", "as": "z_score"}], "$schema": "https://vega.github.io/schema/vega-lite/v3.4.0.json"};
      var opt = {
        "mode": "vega-lite",
        "renderer": "canvas",
        "actions": {"editor": true, "source": true, "export": true}
      };
      vegaEmbed('#transform-rst-altair-plot-44', spec, opt).catch(console.err);
  });
</script>
</div><p>By using two aggregation functions (<code class="docutils literal"><span class="pre">mean</span></code> and <code class="docutils literal"><span class="pre">stdev</span></code>) within the window transform, we are able to compute the z-scores within the calculate transform.</p>
<p>For more information about the arguments to the window transform, see <a class="reference internal" href="generated/core/altair.WindowTransform.html#altair.WindowTransform" title="altair.WindowTransform"><code class="xref py py-class docutils literal"><span class="pre">WindowTransform</span></code></a> and <a class="reference external" href="https://vega.github.io/vega-lite/docs/window.html">the Vega-Lite documentation</a>.</p>
<div class="section" id="id12">
<h3>Transform Options<a class="headerlink" href="#id12" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="generated/toplevel/altair.Chart.html#altair.Chart.transform_window" title="altair.Chart.transform_window"><code class="xref py py-meth docutils literal"><span class="pre">transform_window()</span></code></a> method is built on the <a class="reference internal" href="generated/core/altair.WindowTransform.html#altair.WindowTransform" title="altair.WindowTransform"><code class="xref py py-class docutils literal"><span class="pre">WindowTransform</span></code></a>
class, which has the following options:</p>
<table border="1" class="docutils">
<colgroup>
<col width="13%" />
<col width="25%" />
<col width="63%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Property</th>
<th class="head">Type</th>
<th class="head">Description</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td class="vl-prop">frame</td>
<td>array([null, number])</td>
<td class="vl-decsr"><p class="first">A frame specification as a two-element array indicating how the sliding window should proceed. The array entries should either be a number indicating the offset from the current data object, or null to indicate unbounded rows preceding or following the current data object. The default value is <code class="docutils literal"><span class="pre">[null,</span> <span class="pre">0]</span></code>, indicating that the sliding window includes the current object and all preceding objects. The value <code class="docutils literal"><span class="pre">[-5,</span> <span class="pre">5]</span></code> indicates that the window should include five objects preceding and five objects following the current object. Finally, <code class="docutils literal"><span class="pre">[null,</span> <span class="pre">null]</span></code> indicates that the window frame should always include all data objects. If you this frame and want to assign the same value to add objects, you can use the simpler <a class="reference external" href="https://vega.github.io/vega-lite/docs/joinaggregate.html">join aggregate transform</a>. The only operators affected are the aggregation operations and the <code class="docutils literal"><span class="pre">first_value</span></code>, <code class="docutils literal"><span class="pre">last_value</span></code>, and <code class="docutils literal"><span class="pre">nth_value</span></code> window operations. The other window operations are not affected by this.</p>
<p class="last"><strong>Default value:</strong>:  <code class="docutils literal"><span class="pre">[null,</span> <span class="pre">0]</span></code> (includes the current object and all preceding objects)</p>
</td>
</tr>
<tr class="row-odd"><td class="vl-prop">groupby</td>
<td>array(<a class="reference internal" href="generated/core/altair.FieldName.html#altair.FieldName" title="altair.FieldName"><code class="xref py py-class docutils literal"><span class="pre">FieldName</span></code></a>)</td>
<td class="vl-decsr">The data fields for partitioning the data objects into separate windows. If unspecified, all data points will be in a single window.</td>
</tr>
<tr class="row-even"><td class="vl-prop">ignorePeers</td>
<td><code class="docutils literal"><span class="pre">boolean</span></code></td>
<td class="vl-decsr"><p class="first">Indicates if the sliding window frame should ignore peer values (data that are considered identical by the sort criteria). The default is false, causing the window frame to expand to include all peer values. If set to true, the window frame will be defined by offset values only. This setting only affects those operations that depend on the window frame, namely aggregation operations and the first_value, last_value, and nth_value window operations.</p>
<p class="last"><strong>Default value:</strong> <code class="docutils literal"><span class="pre">false</span></code></p>
</td>
</tr>
<tr class="row-odd"><td class="vl-prop">sort</td>
<td>array(<a class="reference internal" href="generated/core/altair.SortField.html#altair.SortField" title="altair.SortField"><code class="xref py py-class docutils literal"><span class="pre">SortField</span></code></a>)</td>
<td class="vl-decsr">A sort field definition for sorting data objects within a window. If two data objects are considered equal by the comparator, they are considered “peer” values of equal rank. If sort is not specified, the order is undefined: data objects are processed in the order they are observed and none are considered peers (the ignorePeers parameter is ignored and treated as if set to <code class="docutils literal"><span class="pre">true</span></code>).</td>
</tr>
<tr class="row-even"><td class="vl-prop">window</td>
<td>array(<a class="reference internal" href="generated/core/altair.WindowFieldDef.html#altair.WindowFieldDef" title="altair.WindowFieldDef"><code class="xref py py-class docutils literal"><span class="pre">WindowFieldDef</span></code></a>)</td>
<td class="vl-decsr">The definition of the fields in the window, and what calculations to use.</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="interactions.html" class="btn btn-neutral float-right" title="Bindings, Selections, Conditions: Making Charts Interactive" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="marks.html" class="btn btn-neutral" title="Marks" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016-2018, Altair Developers.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'3.2.0',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega@5.4"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-lite@3.4"></script>
      <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/vega-embed@4.2"></script>

  

  <script type="text/javascript" src="../_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>